(function(){"use strict";const B=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,V=Object.keys,z=Array.isArray;function Q(t,e){return typeof e!="object"||V(e).forEach(function(n){t[n]=e[n]}),t}typeof Promise>"u"||B.Promise||(B.Promise=Promise);const Yt=Object.getPrototypeOf,Ei={}.hasOwnProperty;function et(t,e){return Ei.call(t,e)}function kt(t,e){typeof e=="function"&&(e=e(Yt(t))),(typeof Reflect>"u"?V:Reflect.ownKeys)(e).forEach(n=>{ut(t,n,e[n])})}const tr=Object.defineProperty;function ut(t,e,n,r){tr(t,e,Q(n&&et(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function Dt(t){return{from:function(e){return t.prototype=Object.create(e.prototype),ut(t.prototype,"constructor",t),{extend:kt.bind(null,t.prototype)}}}}const mi=Object.getOwnPropertyDescriptor;function ze(t,e){let n;return mi(t,e)||(n=Yt(t))&&ze(n,e)}const Ti=[].slice;function Ee(t,e,n){return Ti.call(t,e,n)}function er(t,e){return e(t)}function Wt(t){if(!t)throw new Error("Assertion Failed")}function nr(t){B.setImmediate?setImmediate(t):setTimeout(t,0)}function rr(t,e){return t.reduce((n,r,i)=>{var s=e(r,i);return s&&(n[s[0]]=s[1]),n},{})}function lt(t,e){if(typeof e=="string"&&et(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,i=e.length;r<i;++r){var s=lt(t,e[r]);n.push(s)}return n}var o=e.indexOf(".");if(o!==-1){var a=t[e.substr(0,o)];return a===void 0?void 0:lt(a,e.substr(o+1))}}function it(t,e,n){if(t&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){Wt(typeof n!="string"&&"length"in n);for(var r=0,i=e.length;r<i;++r)it(t,e[r],n[r])}else{var s=e.indexOf(".");if(s!==-1){var o=e.substr(0,s),a=e.substr(s+1);if(a==="")n===void 0?z(t)&&!isNaN(parseInt(o))?t.splice(o,1):delete t[o]:t[o]=n;else{var u=t[o];u&&et(t,o)||(u=t[o]={}),it(u,a,n)}}else n===void 0?z(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function ir(t){var e={};for(var n in t)et(t,n)&&(e[n]=t[n]);return e}const Ai=[].concat;function sr(t){return Ai.apply([],t)}const or="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(sr([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>B[t]),Ii=or.map(t=>B[t]);rr(or,t=>[t,!0]);let gt=null;function zt(t){gt=typeof WeakMap<"u"&&new WeakMap;const e=Je(t);return gt=null,e}function Je(t){if(!t||typeof t!="object")return t;let e=gt&&gt.get(t);if(e)return e;if(z(t)){e=[],gt&&gt.set(t,e);for(var n=0,r=t.length;n<r;++n)e.push(Je(t[n]))}else if(Ii.indexOf(t.constructor)>=0)e=t;else{const s=Yt(t);for(var i in e=s===Object.prototype?{}:Object.create(s),gt&&gt.set(t,e),t)et(t,i)&&(e[i]=Je(t[i]))}return e}const{toString:bi}={};function Qe(t){return bi.call(t).slice(8,-1)}const Xe=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Li=typeof Xe=="symbol"?function(t){var e;return t!=null&&(e=t[Xe])&&e.apply(t)}:function(){return null},Ut={};function ct(t){var e,n,r,i;if(arguments.length===1){if(z(t))return t.slice();if(this===Ut&&typeof t=="string")return[t];if(i=Li(t)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(t==null)return[t];if(typeof(e=t.length)=="number"){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}const tn=typeof Symbol<"u"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1;var ot=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function ar(t,e){ot=t,ur=e}var ur=()=>!0;const vi=!new Error("").stack;function Rt(){if(vi)try{throw Rt.arguments,new Error}catch(t){return t}return new Error}function en(t,e){var n=t.stack;return n?(e=e||0,n.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),n.split(`
`).slice(e).filter(ur).map(r=>`
`+r).join("")):""}var lr=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],nn=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(lr),Ri={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Bt(t,e){this._e=Rt(),this.name=t,this.message=e}function cr(t,e){return t+". Errors: "+Object.keys(e).map(n=>e[n].toString()).filter((n,r,i)=>i.indexOf(n)===r).join(`
`)}function me(t,e,n,r){this._e=Rt(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=cr(t,e)}function Jt(t,e){this._e=Rt(),this.name="BulkError",this.failures=Object.keys(e).map(n=>e[n]),this.failuresByPos=e,this.message=cr(t,e)}Dt(Bt).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+en(this._e,2))}},toString:function(){return this.name+": "+this.message}}),Dt(me).from(Bt),Dt(Jt).from(Bt);var rn=nn.reduce((t,e)=>(t[e]=e+"Error",t),{});const Ni=Bt;var P=nn.reduce((t,e)=>{var n=e+"Error";function r(i,s){this._e=Rt(),this.name=n,i?typeof i=="string"?(this.message=`${i}${s?`
 `+s:""}`,this.inner=s||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=Ri[e]||n,this.inner=null)}return Dt(r).from(Ni),t[e]=r,t},{});P.Syntax=SyntaxError,P.Type=TypeError,P.Range=RangeError;var hr=lr.reduce((t,e)=>(t[e+"Error"]=P[e],t),{}),Te=nn.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=P[e]),t),{});function M(){}function Qt(t){return t}function wi(t,e){return t==null||t===Qt?e:function(n){return e(t(n))}}function Nt(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function Si(t,e){return t===M?e:function(){var n=t.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Nt(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Nt(i,this.onerror):i),s!==void 0?s:n}}function Pi(t,e){return t===M?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Nt(n,this.onsuccess):n),r&&(this.onerror=this.onerror?Nt(r,this.onerror):r)}}function xi(t,e){return t===M?e:function(n){var r=t.apply(this,arguments);Q(n,r);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Nt(i,this.onsuccess):i),s&&(this.onerror=this.onerror?Nt(s,this.onerror):s),r===void 0?o===void 0?void 0:o:Q(r,o)}}function Ci(t,e){return t===M?e:function(){return e.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function sn(t,e){return t===M?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return n.then(function(){return e.apply(r,s)})}return e.apply(this,arguments)}}Te.ModifyError=me,Te.DexieError=Bt,Te.BulkError=Jt;var Xt={};const fr=100,[on,Ae,an]=typeof Promise>"u"?[]:(()=>{let t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,Yt(t),t];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,Yt(e),t]})(),dr=Ae&&Ae.then,Ie=on&&on.constructor,un=!!an;var ln=!1,Oi=an?()=>{an.then(Re)}:B.setImmediate?setImmediate.bind(null,Re):B.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{Re(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(Re,0)},te=function(t,e){ee.push([t,e]),be&&(Oi(),be=!1)},cn=!0,be=!0,wt=[],Le=[],hn=null,fn=Qt,Ft={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:br,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{br(t[0],t[1])}catch{}})}},w=Ft,ee=[],St=0,ve=[];function N(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=M,this._lib=!1;var e=this._PSD=w;if(ot&&(this._stackHolder=Rt(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==Xt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&_n(this,this._value))}this._state=null,this._value=null,++e.ref,pr(this,t)}const dn={get:function(){var t=w,e=Se;function n(r,i){var s=!t.global&&(t!==w||e!==Se);const o=s&&!ht();var a=new N((u,c)=>{pn(this,new _r(xe(r,t,s,o),xe(i,t,s,o),u,c,t))});return ot&&Er(a,this),a}return n.prototype=Xt,n},set:function(t){ut(this,"then",t&&t.prototype===Xt?dn:{get:function(){return t},set:dn.set})}};function _r(t,e,n,r,i){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=i}function pr(t,e){try{e(n=>{if(t._state===null){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&ne();n&&typeof n.then=="function"?pr(t,(i,s)=>{n instanceof N?n._then(i,s):n.then(i,s)}):(t._state=!0,t._value=n,yr(t)),r&&re()}},_n.bind(null,t))}catch(n){_n(t,n)}}function _n(t,e){if(Le.push(e),t._state===null){var n=t._lib&&ne();e=fn(e),t._state=!1,t._value=e,ot&&e!==null&&typeof e=="object"&&!e._promise&&function(r,i,s){try{r.apply(null,s)}catch(o){i&&i(o)}}(()=>{var r=ze(e,"stack");e._promise=t,ut(e,"stack",{get:()=>ln?r&&(r.get?r.get.apply(e):r.value):t.stack})}),function(r){wt.some(i=>i._value===r._value)||wt.push(r)}(t),yr(t),n&&re()}}function yr(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)pn(t,e[n]);var i=t._PSD;--i.ref||i.finalize(),St===0&&(++St,te(()=>{--St==0&&yn()},[]))}function pn(t,e){if(t._state!==null){var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++St,te(Mi,[n,t,e])}else t._listeners.push(e)}function Mi(t,e,n){try{hn=e;var r,i=e._value;e._state?r=t(i):(Le.length&&(Le=[]),r=t(i),Le.indexOf(i)===-1&&function(s){for(var o=wt.length;o;)if(wt[--o]._value===s._value)return void wt.splice(o,1)}(e)),n.resolve(r)}catch(s){n.reject(s)}finally{hn=null,--St==0&&yn(),--n.psd.ref||n.psd.finalize()}}function gr(t,e,n){if(e.length===n)return e;var r="";if(t._state===!1){var i,s,o=t._value;o!=null?(i=o.name||"Error",s=o.message||o,r=en(o,0)):(i=o,s=""),e.push(i+(s?": "+s:"")+r)}return ot&&((r=en(t._stackHolder,2))&&e.indexOf(r)===-1&&e.push(r),t._prev&&gr(t._prev,e,n)),e}function Er(t,e){var n=e?e._numPrev+1:0;n<100&&(t._prev=e,t._numPrev=n)}function Re(){ne()&&re()}function ne(){var t=cn;return cn=!1,be=!1,t}function re(){var t,e,n;do for(;ee.length>0;)for(t=ee,ee=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(ee.length>0);cn=!0,be=!0}function yn(){var t=wt;wt=[],t.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var e=ve.slice(0),n=e.length;n;)e[--n]()}function Ne(t){return new N(Xt,!1,t)}function F(t,e){var n=w;return function(){var r=ne(),i=w;try{return mt(n,!0),t.apply(this,arguments)}catch(s){e&&e(s)}finally{mt(i,!1),r&&re()}}}kt(N.prototype,{then:dn,_then:function(t,e){pn(this,new _r(null,null,t,e,w))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],n=arguments[1];return typeof e=="function"?this.then(null,r=>r instanceof e?n(r):Ne(r)):this.then(null,r=>r&&r.name===e?n(r):Ne(r))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),Ne(e)))},stack:{get:function(){if(this._stack)return this._stack;try{ln=!0;var t=gr(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=t),t}finally{ln=!1}}},timeout:function(t,e){return t<1/0?new N((n,r)=>{var i=setTimeout(()=>r(new P.Timeout(e)),t);this.then(n,r).finally(clearTimeout.bind(null,i))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&ut(N.prototype,Symbol.toStringTag,"Dexie.Promise"),Ft.env=mr(),kt(N,{all:function(){var t=ct.apply(null,arguments).map(Pe);return new N(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach((i,s)=>N.resolve(i).then(o=>{t[s]=o,--r||e(t)},n))})},resolve:t=>{if(t instanceof N)return t;if(t&&typeof t.then=="function")return new N((n,r)=>{t.then(n,r)});var e=new N(Xt,!0,t);return Er(e,hn),e},reject:Ne,race:function(){var t=ct.apply(null,arguments).map(Pe);return new N((e,n)=>{t.map(r=>N.resolve(r).then(e,n))})},PSD:{get:()=>w,set:t=>w=t},totalEchoes:{get:()=>Se},newPSD:Et,usePSD:Kt,scheduler:{get:()=>te,set:t=>{te=t}},rejectionMapper:{get:()=>fn,set:t=>{fn=t}},follow:(t,e)=>new N((n,r)=>Et((i,s)=>{var o=w;o.unhandleds=[],o.onunhandled=s,o.finalize=Nt(function(){(function(a){function u(){a(),ve.splice(ve.indexOf(u),1)}ve.push(u),++St,te(()=>{--St==0&&yn()},[])})(()=>{this.unhandleds.length===0?i():s(this.unhandleds[0])})},o.finalize),t()},e,n,r))}),Ie&&(Ie.allSettled&&ut(N,"allSettled",function(){const t=ct.apply(null,arguments).map(Pe);return new N(e=>{t.length===0&&e([]);let n=t.length;const r=new Array(n);t.forEach((i,s)=>N.resolve(i).then(o=>r[s]={status:"fulfilled",value:o},o=>r[s]={status:"rejected",reason:o}).then(()=>--n||e(r)))})}),Ie.any&&typeof AggregateError<"u"&&ut(N,"any",function(){const t=ct.apply(null,arguments).map(Pe);return new N((e,n)=>{t.length===0&&n(new AggregateError([]));let r=t.length;const i=new Array(r);t.forEach((s,o)=>N.resolve(s).then(a=>e(a),a=>{i[o]=a,--r||n(new AggregateError(i))}))})}));const J={awaits:0,echoes:0,id:0};var ki=0,we=[],gn=0,Se=0,Di=0;function Et(t,e,n,r){var i=w,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++Di;var o=Ft.env;s.env=un?{Promise:N,PromiseProp:{value:N,configurable:!0,writable:!0},all:N.all,race:N.race,allSettled:N.allSettled,any:N.any,resolve:N.resolve,reject:N.reject,nthen:Ar(o.nthen,s),gthen:Ar(o.gthen,s)}:{},e&&Q(s,e),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=Kt(s,t,n,r);return s.ref===0&&s.finalize(),a}function Gt(){return J.id||(J.id=++ki),++J.awaits,J.echoes+=fr,J.id}function ht(){return!!J.awaits&&(--J.awaits==0&&(J.id=0),J.echoes=J.awaits*fr,!0)}function Pe(t){return J.echoes&&t&&t.constructor===Ie?(Gt(),t.then(e=>(ht(),e),e=>(ht(),Z(e)))):t}function Ui(t){++Se,J.echoes&&--J.echoes!=0||(J.echoes=J.id=0),we.push(w),mt(t,!0)}function Bi(){var t=we[we.length-1];we.pop(),mt(t,!1)}function mt(t,e){var n=w;if((e?!J.echoes||gn++&&t===w:!gn||--gn&&t===w)||Tr(e?Ui.bind(null,t):Bi),t!==w&&(w=t,n===Ft&&(Ft.env=mr()),un)){var r=Ft.env.Promise,i=t.env;Ae.then=i.nthen,r.prototype.then=i.gthen,(n.global||t.global)&&(Object.defineProperty(B,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function mr(){var t=B.Promise;return un?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(B,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:Ae.then,gthen:t.prototype.then}:{}}function Kt(t,e,n,r,i){var s=w;try{return mt(t,!0),e(n,r,i)}finally{mt(s,!1)}}function Tr(t){dr.call(on,t)}function xe(t,e,n,r){return typeof t!="function"?t:function(){var i=w;n&&Gt(),mt(e,!0);try{return t.apply(this,arguments)}finally{mt(i,!1),r&&Tr(ht)}}}function Ar(t,e){return function(n,r){return t.call(this,xe(n,e),xe(r,e))}}(""+dr).indexOf("[native code]")===-1&&(Gt=ht=M);const Ir="unhandledrejection";function br(t,e){var n;try{n=e.onuncatched(t)}catch{}if(n!==!1)try{var r,i={promise:e,reason:t};if(B.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(Ir,!0,!0),Q(r,i)):B.CustomEvent&&Q(r=new CustomEvent(Ir,{detail:i}),i),r&&B.dispatchEvent&&(dispatchEvent(r),!B.PromiseRejectionEvent&&B.onunhandledrejection))try{B.onunhandledrejection(r)}catch{}ot&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch{}}var Z=N.reject;function En(t,e,n,r){if(t.idbdb&&(t._state.openComplete||w.letThrough||t._vip)){var i=t._createTransaction(e,n,t._dbSchema);try{i.create(),t._state.PR1398_maxLoop=3}catch(s){return s.name===rn.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>En(t,e,n,r))):Z(s)}return i._promise(e,(s,o)=>Et(()=>(w.trans=i,r(s,o,i)))).then(s=>i._completion.then(()=>s))}if(t._state.openComplete)return Z(new P.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return Z(new P.DatabaseClosed);t.open().catch(M)}return t._state.dbReadyPromise.then(()=>En(t,e,n,r))}const Lr="3.2.5",Pt="￿",mn=-1/0,ft="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",vr="String expected.",ie=[],Ce=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Fi=Ce,Gi=Ce,Rr=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),Oe="__dbnames",Tn="readonly",An="readwrite";function xt(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}const Nr={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Me(t){return typeof t!="string"||/\./.test(t)?e=>e:e=>(e[t]===void 0&&t in e&&delete(e=zt(e))[t],e)}class Ki{_trans(e,n,r){const i=this._tx||w.trans,s=this.name;function o(u,c,l){if(!l.schema[s])throw new P.NotFound("Table "+s+" not part of transaction");return n(l.idbtrans,l)}const a=ne();try{return i&&i.db===this.db?i===w.trans?i._promise(e,o,r):Et(()=>i._promise(e,o,r),{trans:i,transless:w.transless||w}):En(this.db,e,[this.name],o)}finally{a&&re()}}get(e,n){return e&&e.constructor===Object?this.where(e).first(n):this._trans("readonly",r=>this.core.get({trans:r,key:e}).then(i=>this.hook.reading.fire(i))).then(n)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(z(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const n=V(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter(c=>{if(c.compound&&n.every(l=>c.keyPath.indexOf(l)>=0)){for(let l=0;l<n.length;++l)if(n.indexOf(c.keyPath[l])===-1)return!1;return!0}return!1}).sort((c,l)=>c.keyPath.length-l.keyPath.length)[0];if(r&&this.db._maxKey!==Pt){const c=r.keyPath.slice(0,n.length);return this.where(c).equals(c.map(l=>e[l]))}!r&&ot&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${n.join("+")}]`);const{idxByName:i}=this.schema,s=this.db._deps.indexedDB;function o(c,l){try{return s.cmp(c,l)===0}catch{return!1}}const[a,u]=n.reduce(([c,l],f)=>{const h=i[f],d=e[f];return[c||h,c||!h?xt(l,h&&h.multi?_=>{const y=lt(_,f);return z(y)&&y.some(m=>o(d,m))}:_=>o(d,lt(_,f))):l]},[null,null]);return a?this.where(a.name).equals(e[a.keyPath]).filter(u):r?this.filter(u):this.where(n).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,z(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const n=r=>{if(!r)return r;const i=Object.create(e.prototype);for(var s in r)if(et(r,s))try{i[s]=r[s]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),e}defineClass(){return this.mapToClass(function(e){Q(this,e)})}add(e,n){const{auto:r,keyPath:i}=this.schema.primKey;let s=e;return i&&r&&(s=Me(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:n!=null?[n]:null,values:[s]})).then(o=>o.numFailures?N.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{it(e,i,o)}catch{}return o})}update(e,n){if(typeof e!="object"||z(e))return this.where(":id").equals(e).modify(n);{const r=lt(e,this.schema.primKey.keyPath);if(r===void 0)return Z(new P.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?V(n).forEach(i=>{it(e,i,n[i])}):n(e,{value:e,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}}put(e,n){const{auto:r,keyPath:i}=this.schema.primKey;let s=e;return i&&r&&(s=Me(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[s],keys:n!=null?[n]:null})).then(o=>o.numFailures?N.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{it(e,i,o)}catch{}return o})}delete(e){return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:[e]})).then(n=>n.numFailures?N.reject(n.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:Nr})).then(e=>e.numFailures?N.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",n=>this.core.getMany({keys:e,trans:n}).then(r=>r.map(i=>this.hook.reading.fire(i))))}bulkAdd(e,n,r){const i=Array.isArray(n)?n:void 0,s=(r=r||(i?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:a,keyPath:u}=this.schema.primKey;if(u&&i)throw new P.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new P.InvalidArgument("Arguments objects and keys must have the same length");const c=e.length;let l=u&&a?e.map(Me(u)):e;return this.core.mutate({trans:o,type:"add",keys:i,values:l,wantResults:s}).then(({numFailures:f,results:h,lastResult:d,failures:_})=>{if(f===0)return s?h:d;throw new Jt(`${this.name}.bulkAdd(): ${f} of ${c} operations failed`,_)})})}bulkPut(e,n,r){const i=Array.isArray(n)?n:void 0,s=(r=r||(i?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:a,keyPath:u}=this.schema.primKey;if(u&&i)throw new P.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new P.InvalidArgument("Arguments objects and keys must have the same length");const c=e.length;let l=u&&a?e.map(Me(u)):e;return this.core.mutate({trans:o,type:"put",keys:i,values:l,wantResults:s}).then(({numFailures:f,results:h,lastResult:d,failures:_})=>{if(f===0)return s?h:d;throw new Jt(`${this.name}.bulkPut(): ${f} of ${c} operations failed`,_)})})}bulkDelete(e){const n=e.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:e})).then(({numFailures:r,lastResult:i,failures:s})=>{if(r===0)return i;throw new Jt(`${this.name}.bulkDelete(): ${r} of ${n} operations failed`,s)})}}function se(t){var e={},n=function(o,a){if(a){for(var u=arguments.length,c=new Array(u-1);--u;)c[u-1]=arguments[u];return e[o].subscribe.apply(null,c),t}if(typeof o=="string")return e[o]};n.addEventType=s;for(var r=1,i=arguments.length;r<i;++r)s(arguments[r]);return n;function s(o,a,u){if(typeof o!="object"){var c;a||(a=Ci),u||(u=M);var l={subscribers:[],fire:u,subscribe:function(f){l.subscribers.indexOf(f)===-1&&(l.subscribers.push(f),l.fire=a(l.fire,f))},unsubscribe:function(f){l.subscribers=l.subscribers.filter(function(h){return h!==f}),l.fire=l.subscribers.reduce(a,u)}};return e[o]=n[o]=l,l}V(c=o).forEach(function(f){var h=c[f];if(z(h))s(f,c[f][0],c[f][1]);else{if(h!=="asap")throw new P.InvalidArgument("Invalid event config");var d=s(f,Qt,function(){for(var _=arguments.length,y=new Array(_);_--;)y[_]=arguments[_];d.subscribers.forEach(function(m){nr(function(){m.apply(null,y)})})})}})}}function oe(t,e){return Dt(e).from({prototype:t}),e}function jt(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function In(t,e){t.filter=xt(t.filter,e)}function bn(t,e,n){var r=t.replayFilter;t.replayFilter=r?()=>xt(r(),e()):e,t.justLimit=n&&!r}function ke(t,e){if(t.isPrimKey)return e.primaryKey;const n=e.getIndexByKeyPath(t.index);if(!n)throw new P.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function wr(t,e,n){const r=ke(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function De(t,e,n,r){const i=t.replayFilter?xt(t.filter,t.replayFilter()):t.filter;if(t.or){const s={},o=(a,u,c)=>{if(!i||i(u,c,h=>u.stop(h),h=>u.fail(h))){var l=u.primaryKey,f=""+l;f==="[object ArrayBuffer]"&&(f=""+new Uint8Array(l)),et(s,f)||(s[f]=!0,e(a,u,c))}};return Promise.all([t.or._iterate(o,n),Sr(wr(t,r,n),t.algorithm,o,!t.keysOnly&&t.valueMapper)])}return Sr(wr(t,r,n),xt(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function Sr(t,e,n,r){var i=F(r?(s,o,a)=>n(r(s),o,a):n);return t.then(s=>{if(s)return s.start(()=>{var o=()=>s.continue();e&&!e(s,a=>o=a,a=>{s.stop(a),o=M},a=>{s.fail(a),o=M})||i(s.value,s,a=>o=a),o()})})}function X(t,e){try{const n=Pr(t),r=Pr(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return function(i,s){const o=i.length,a=s.length,u=o<a?o:a;for(let c=0;c<u;++c)if(i[c]!==s[c])return i[c]<s[c]?-1:1;return o===a?0:o<a?-1:1}(xr(t),xr(e));case"Array":return function(i,s){const o=i.length,a=s.length,u=o<a?o:a;for(let c=0;c<u;++c){const l=X(i[c],s[c]);if(l!==0)return l}return o===a?0:o<a?-1:1}(t,e)}}catch{}return NaN}function Pr(t){const e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";const n=Qe(t);return n==="ArrayBuffer"?"binary":n}function xr(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}class ji{_read(e,n){var r=this._ctx;return r.error?r.table._trans(null,Z.bind(null,r.error)):r.table._trans("readonly",e).then(n)}_write(e){var n=this._ctx;return n.error?n.table._trans(null,Z.bind(null,n.error)):n.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var n=this._ctx;n.algorithm=xt(n.algorithm,e)}_iterate(e,n){return De(this._ctx,e,n,this._ctx.table.core)}clone(e){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&Q(r,e),n._ctx=r,n}raw(){return this._ctx.valueMapper=null,this}each(e){var n=this._ctx;return this._read(r=>De(n,e,r,n.table.core))}count(e){return this._read(n=>{const r=this._ctx,i=r.table.core;if(jt(r,!0))return i.count({trans:n,query:{index:ke(r,i.schema),range:r.range}}).then(o=>Math.min(o,r.limit));var s=0;return De(r,()=>(++s,!1),n,i).then(()=>s)}).then(e)}sortBy(e,n){const r=e.split(".").reverse(),i=r[0],s=r.length-1;function o(c,l){return l?o(c[r[l]],l-1):c[i]}var a=this._ctx.dir==="next"?1:-1;function u(c,l){var f=o(c,s),h=o(l,s);return f<h?-a:f>h?a:0}return this.toArray(function(c){return c.sort(u)}).then(n)}toArray(e){return this._read(n=>{var r=this._ctx;if(r.dir==="next"&&jt(r,!0)&&r.limit>0){const{valueMapper:i}=r,s=ke(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:s,range:r.range}}).then(({result:o})=>i?o.map(i):o)}{const i=[];return De(r,s=>i.push(s),n,r.table.core).then(()=>i)}},e)}offset(e){var n=this._ctx;return e<=0||(n.offset+=e,jt(n)?bn(n,()=>{var r=e;return(i,s)=>r===0||(r===1?(--r,!1):(s(()=>{i.advance(r),r=0}),!1))}):bn(n,()=>{var r=e;return()=>--r<0})),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),bn(this._ctx,()=>{var n=e;return function(r,i,s){return--n<=0&&i(s),n>=0}},!0),this}until(e,n){return In(this._ctx,function(r,i,s){return!e(r.value)||(i(s),n)}),this}first(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){var n,r;return In(this._ctx,function(i){return e(i.value)}),n=this._ctx,r=e,n.isMatch=xt(n.isMatch,r),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.key,i)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.primaryKey,i)})}keys(e){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,s){r.push(s.key)}).then(function(){return r}).then(e)}primaryKeys(e){var n=this._ctx;if(n.dir==="next"&&jt(n,!0)&&n.limit>0)return this._read(i=>{var s=ke(n,n.table.core.schema);return n.table.core.query({trans:i,values:!1,limit:n.limit,query:{index:s,range:n.range}})}).then(({result:i})=>i).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,s){r.push(s.primaryKey)}).then(function(){return r}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(n){return n[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return In(this._ctx,function(i){var s=i.primaryKey.toString(),o=et(r,s);return r[s]=!0,!o}),this}modify(e){var n=this._ctx;return this._write(r=>{var i;if(typeof e=="function")i=e;else{var s=V(e),o=s.length;i=function(y){for(var m=!1,g=0;g<o;++g){var p=s[g],E=e[p];lt(y,p)!==E&&(it(y,p,E),m=!0)}return m}}const a=n.table.core,{outbound:u,extractKey:c}=a.schema.primaryKey,l=this.db._options.modifyChunkSize||200,f=[];let h=0;const d=[],_=(y,m)=>{const{failures:g,numFailures:p}=m;h+=y-p;for(let E of V(g))f.push(g[E])};return this.clone().primaryKeys().then(y=>{const m=g=>{const p=Math.min(l,y.length-g);return a.getMany({trans:r,keys:y.slice(g,g+p),cache:"immutable"}).then(E=>{const T=[],L=[],R=u?[]:null,b=[];for(let I=0;I<p;++I){const C=E[I],O={value:zt(C),primKey:y[g+I]};i.call(O,O.value,O)!==!1&&(O.value==null?b.push(y[g+I]):u||X(c(C),c(O.value))===0?(L.push(O.value),u&&R.push(y[g+I])):(b.push(y[g+I]),T.push(O.value)))}const S=jt(n)&&n.limit===1/0&&(typeof e!="function"||e===Ln)&&{index:n.index,range:n.range};return Promise.resolve(T.length>0&&a.mutate({trans:r,type:"add",values:T}).then(I=>{for(let C in I.failures)b.splice(parseInt(C),1);_(T.length,I)})).then(()=>(L.length>0||S&&typeof e=="object")&&a.mutate({trans:r,type:"put",keys:R,values:L,criteria:S,changeSpec:typeof e!="function"&&e}).then(I=>_(L.length,I))).then(()=>(b.length>0||S&&e===Ln)&&a.mutate({trans:r,type:"delete",keys:b,criteria:S}).then(I=>_(b.length,I))).then(()=>y.length>g+p&&m(g+l))})};return m(0).then(()=>{if(f.length>0)throw new me("Error modifying one or more objects",f,h,d);return y.length})})})}delete(){var e=this._ctx,n=e.range;return jt(e)&&(e.isPrimKey&&!Gi||n.type===3)?this._write(r=>{const{primaryKey:i}=e.table.core.schema,s=n;return e.table.core.count({trans:r,query:{index:i,range:s}}).then(o=>e.table.core.mutate({trans:r,type:"deleteRange",range:s}).then(({failures:a,lastResult:u,results:c,numFailures:l})=>{if(l)throw new me("Could not delete some values",Object.keys(a).map(f=>a[f]),o-l);return o-l}))}):this.modify(Ln)}}const Ln=(t,e)=>e.value=null;function $i(t,e){return t<e?-1:t===e?0:1}function Vi(t,e){return t>e?-1:t===e?0:1}function nt(t,e,n){var r=t instanceof Or?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function $t(t){return new t.Collection(t,()=>Cr("")).limit(0)}function Hi(t,e,n,r,i,s){for(var o=Math.min(t.length,r.length),a=-1,u=0;u<o;++u){var c=e[u];if(c!==r[u])return i(t[u],n[u])<0?t.substr(0,u)+n[u]+n.substr(u+1):i(t[u],r[u])<0?t.substr(0,u)+r[u]+n.substr(u+1):a>=0?t.substr(0,a)+e[a]+n.substr(a+1):null;i(t[u],c)<0&&(a=u)}return o<r.length&&s==="next"?t+n.substr(t.length):o<t.length&&s==="prev"?t.substr(0,n.length):a<0?null:t.substr(0,a)+r[a]+n.substr(a+1)}function Ue(t,e,n,r){var i,s,o,a,u,c,l,f=n.length;if(!n.every(y=>typeof y=="string"))return nt(t,vr);function h(y){i=function(g){return g==="next"?p=>p.toUpperCase():p=>p.toLowerCase()}(y),s=function(g){return g==="next"?p=>p.toLowerCase():p=>p.toUpperCase()}(y),o=y==="next"?$i:Vi;var m=n.map(function(g){return{lower:s(g),upper:i(g)}}).sort(function(g,p){return o(g.lower,p.lower)});a=m.map(function(g){return g.upper}),u=m.map(function(g){return g.lower}),c=y,l=y==="next"?"":r}h("next");var d=new t.Collection(t,()=>Tt(a[0],u[f-1]+r));d._ondirectionchange=function(y){h(y)};var _=0;return d._addAlgorithm(function(y,m,g){var p=y.key;if(typeof p!="string")return!1;var E=s(p);if(e(E,u,_))return!0;for(var T=null,L=_;L<f;++L){var R=Hi(p,E,a[L],u[L],o,c);R===null&&T===null?_=L+1:(T===null||o(T,R)>0)&&(T=R)}return m(T!==null?function(){y.continue(T+l)}:g),!1}),d}function Tt(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function Cr(t){return{type:1,lower:t,upper:t}}class Or{get Collection(){return this._ctx.table.db.Collection}between(e,n,r,i){r=r!==!1,i=i===!0;try{return this._cmp(e,n)>0||this._cmp(e,n)===0&&(r||i)&&(!r||!i)?$t(this):new this.Collection(this,()=>Tt(e,n,!r,!i))}catch{return nt(this,ft)}}equals(e){return e==null?nt(this,ft):new this.Collection(this,()=>Cr(e))}above(e){return e==null?nt(this,ft):new this.Collection(this,()=>Tt(e,void 0,!0))}aboveOrEqual(e){return e==null?nt(this,ft):new this.Collection(this,()=>Tt(e,void 0,!1))}below(e){return e==null?nt(this,ft):new this.Collection(this,()=>Tt(void 0,e,!1,!0))}belowOrEqual(e){return e==null?nt(this,ft):new this.Collection(this,()=>Tt(void 0,e))}startsWith(e){return typeof e!="string"?nt(this,vr):this.between(e,e+Pt,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):Ue(this,(n,r)=>n.indexOf(r[0])===0,[e],Pt)}equalsIgnoreCase(e){return Ue(this,(n,r)=>n===r[0],[e],"")}anyOfIgnoreCase(){var e=ct.apply(Ut,arguments);return e.length===0?$t(this):Ue(this,(n,r)=>r.indexOf(n)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=ct.apply(Ut,arguments);return e.length===0?$t(this):Ue(this,(n,r)=>r.some(i=>n.indexOf(i)===0),e,Pt)}anyOf(){const e=ct.apply(Ut,arguments);let n=this._cmp;try{e.sort(n)}catch{return nt(this,ft)}if(e.length===0)return $t(this);const r=new this.Collection(this,()=>Tt(e[0],e[e.length-1]));r._ondirectionchange=s=>{n=s==="next"?this._ascending:this._descending,e.sort(n)};let i=0;return r._addAlgorithm((s,o,a)=>{const u=s.key;for(;n(u,e[i])>0;)if(++i,i===e.length)return o(a),!1;return n(u,e[i])===0||(o(()=>{s.continue(e[i])}),!1)}),r}notEqual(e){return this.inAnyRange([[mn,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=ct.apply(Ut,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return nt(this,ft)}const n=e.reduce((r,i)=>r?r.concat([[r[r.length-1][1],i]]):[[mn,i]],null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,n){const r=this._cmp,i=this._ascending,s=this._descending,o=this._min,a=this._max;if(e.length===0)return $t(this);if(!e.every(p=>p[0]!==void 0&&p[1]!==void 0&&i(p[0],p[1])<=0))return nt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",P.InvalidArgument);const u=!n||n.includeLowers!==!1,c=n&&n.includeUppers===!0;let l,f=i;function h(p,E){return f(p[0],E[0])}try{l=e.reduce(function(p,E){let T=0,L=p.length;for(;T<L;++T){const R=p[T];if(r(E[0],R[1])<0&&r(E[1],R[0])>0){R[0]=o(R[0],E[0]),R[1]=a(R[1],E[1]);break}}return T===L&&p.push(E),p},[]),l.sort(h)}catch{return nt(this,ft)}let d=0;const _=c?p=>i(p,l[d][1])>0:p=>i(p,l[d][1])>=0,y=u?p=>s(p,l[d][0])>0:p=>s(p,l[d][0])>=0;let m=_;const g=new this.Collection(this,()=>Tt(l[0][0],l[l.length-1][1],!u,!c));return g._ondirectionchange=p=>{p==="next"?(m=_,f=i):(m=y,f=s),l.sort(h)},g._addAlgorithm((p,E,T)=>{for(var L=p.key;m(L);)if(++d,d===l.length)return E(T),!1;return!!function(R){return!_(R)&&!y(R)}(L)||(this._cmp(L,l[d][1])===0||this._cmp(L,l[d][0])===0||E(()=>{f===i?p.continue(l[d][0]):p.continue(l[d][1])}),!1)}),g}startsWithAnyOf(){const e=ct.apply(Ut,arguments);return e.every(n=>typeof n=="string")?e.length===0?$t(this):this.inAnyRange(e.map(n=>[n,n+Pt])):nt(this,"startsWithAnyOf() only works with strings")}}function at(t){return F(function(e){return ae(e),t(e.target.error),!1})}function ae(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}const ue="storagemutated",At="x-storagemutated-1",It=se(null,ue);class qi{_lock(){return Wt(!w.global),++this._reculock,this._reculock!==1||w.global||(w.lockOwnerFor=this),this}_unlock(){if(Wt(!w.global),--this._reculock==0)for(w.global||(w.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{Kt(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&w.lockOwnerFor!==this}create(e){if(!this.mode)return this;const n=this.db.idbdb,r=this.db._state.dbOpenError;if(Wt(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new P.DatabaseClosed(r);case"MissingAPIError":throw new P.MissingAPI(r.message,r);default:throw new P.OpenFailed(r)}if(!this.active)throw new P.TransactionInactive;return Wt(this._completion._state===null),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=F(i=>{ae(i),this._reject(e.error)}),e.onabort=F(i=>{ae(i),this.active&&this._reject(new P.Abort(e.error)),this.active=!1,this.on("abort").fire(i)}),e.oncomplete=F(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&It.storagemutated.fire(e.mutatedParts)}),this}_promise(e,n,r){if(e==="readwrite"&&this.mode!=="readwrite")return Z(new P.ReadOnly("Transaction is readonly"));if(!this.active)return Z(new P.TransactionInactive);if(this._locked())return new N((s,o)=>{this._blockedFuncs.push([()=>{this._promise(e,n,r).then(s,o)},w])});if(r)return Et(()=>{var s=new N((o,a)=>{this._lock();const u=n(o,a,this);u&&u.then&&u.then(o,a)});return s.finally(()=>this._unlock()),s._lib=!0,s});var i=new N((s,o)=>{var a=n(s,o,this);a&&a.then&&a.then(s,o)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(e){var n=this._root();const r=N.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then(()=>r);else{n._waitingFor=r,n._waitingQueue=[];var i=n.idbtrans.objectStore(n.storeNames[0]);(function o(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(i.get(-1/0).onsuccess=o)})()}var s=n._waitingFor;return new N((o,a)=>{r.then(u=>n._waitingQueue.push(F(o.bind(null,u))),u=>n._waitingQueue.push(F(a.bind(null,u)))).finally(()=>{n._waitingFor===s&&(n._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new P.Abort))}table(e){const n=this._memoizedTables||(this._memoizedTables={});if(et(n,e))return n[e];const r=this.schema[e];if(!r)throw new P.NotFound("Table "+e+" not part of transaction");const i=new this.db.Table(e,r,this);return i.core=this.db.core.table(e),n[e]=i,i}}function vn(t,e,n,r,i,s,o){return{name:t,keyPath:e,unique:n,multi:r,auto:i,compound:s,src:(n&&!o?"&":"")+(r?"*":"")+(i?"++":"")+Mr(e)}}function Mr(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function kr(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:rr(n,r=>[r.name,r])}}let le=t=>{try{return t.only([[]]),le=()=>[[]],[[]]}catch{return le=()=>Pt,Pt}};function Rn(t){return t==null?()=>{}:typeof t=="string"?function(e){return e.split(".").length===1?r=>r[e]:r=>lt(r,e)}(t):e=>lt(e,t)}function Dr(t){return[].slice.call(t)}let Zi=0;function ce(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function Yi(t,e,n){function r(u){if(u.type===3)return null;if(u.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:c,upper:l,lowerOpen:f,upperOpen:h}=u;return c===void 0?l===void 0?null:e.upperBound(l,!!h):l===void 0?e.lowerBound(c,!!f):e.bound(c,l,!!f,!!h)}const{schema:i,hasGetAll:s}=function(u,c){const l=Dr(u.objectStoreNames);return{schema:{name:u.name,tables:l.map(f=>c.objectStore(f)).map(f=>{const{keyPath:h,autoIncrement:d}=f,_=z(h),y=h==null,m={},g={name:f.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:y,compound:_,keyPath:h,autoIncrement:d,unique:!0,extractKey:Rn(h)},indexes:Dr(f.indexNames).map(p=>f.index(p)).map(p=>{const{name:E,unique:T,multiEntry:L,keyPath:R}=p,b={name:E,compound:z(R),keyPath:R,unique:T,multiEntry:L,extractKey:Rn(R)};return m[ce(R)]=b,b}),getIndexByKeyPath:p=>m[ce(p)]};return m[":id"]=g.primaryKey,h!=null&&(m[ce(h)]=g.primaryKey),g})},hasGetAll:l.length>0&&"getAll"in c.objectStore(l[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,n),o=i.tables.map(u=>function(c){const l=c.name;return{name:l,schema:c,mutate:function({trans:f,type:h,keys:d,values:_,range:y}){return new Promise((m,g)=>{m=F(m);const p=f.objectStore(l),E=p.keyPath==null,T=h==="put"||h==="add";if(!T&&h!=="delete"&&h!=="deleteRange")throw new Error("Invalid operation type: "+h);const{length:L}=d||_||{length:1};if(d&&_&&d.length!==_.length)throw new Error("Given keys array must have same length as given values array.");if(L===0)return m({numFailures:0,failures:{},results:[],lastResult:void 0});let R;const b=[],S=[];let I=0;const C=$=>{++I,ae($)};if(h==="deleteRange"){if(y.type===4)return m({numFailures:I,failures:S,results:[],lastResult:void 0});y.type===3?b.push(R=p.clear()):b.push(R=p.delete(r(y)))}else{const[$,H]=T?E?[_,d]:[_,null]:[d,null];if(T)for(let U=0;U<L;++U)b.push(R=H&&H[U]!==void 0?p[h]($[U],H[U]):p[h]($[U])),R.onerror=C;else for(let U=0;U<L;++U)b.push(R=p[h]($[U])),R.onerror=C}const O=$=>{const H=$.target.result;b.forEach((U,st)=>U.error!=null&&(S[st]=U.error)),m({numFailures:I,failures:S,results:h==="delete"?d:b.map(U=>U.result),lastResult:H})};R.onerror=$=>{C($),O($)},R.onsuccess=O})},getMany:({trans:f,keys:h})=>new Promise((d,_)=>{d=F(d);const y=f.objectStore(l),m=h.length,g=new Array(m);let p,E=0,T=0;const L=b=>{const S=b.target;g[S._pos]=S.result,++T===E&&d(g)},R=at(_);for(let b=0;b<m;++b)h[b]!=null&&(p=y.get(h[b]),p._pos=b,p.onsuccess=L,p.onerror=R,++E);E===0&&d(g)}),get:({trans:f,key:h})=>new Promise((d,_)=>{d=F(d);const y=f.objectStore(l).get(h);y.onsuccess=m=>d(m.target.result),y.onerror=at(_)}),query:function(f){return h=>new Promise((d,_)=>{d=F(d);const{trans:y,values:m,limit:g,query:p}=h,E=g===1/0?void 0:g,{index:T,range:L}=p,R=y.objectStore(l),b=T.isPrimaryKey?R:R.index(T.name),S=r(L);if(g===0)return d({result:[]});if(f){const I=m?b.getAll(S,E):b.getAllKeys(S,E);I.onsuccess=C=>d({result:C.target.result}),I.onerror=at(_)}else{let I=0;const C=m||!("openKeyCursor"in b)?b.openCursor(S):b.openKeyCursor(S),O=[];C.onsuccess=$=>{const H=C.result;return H?(O.push(m?H.value:H.primaryKey),++I===g?d({result:O}):void H.continue()):d({result:O})},C.onerror=at(_)}})}(s),openCursor:function({trans:f,values:h,query:d,reverse:_,unique:y}){return new Promise((m,g)=>{m=F(m);const{index:p,range:E}=d,T=f.objectStore(l),L=p.isPrimaryKey?T:T.index(p.name),R=_?y?"prevunique":"prev":y?"nextunique":"next",b=h||!("openKeyCursor"in L)?L.openCursor(r(E),R):L.openKeyCursor(r(E),R);b.onerror=at(g),b.onsuccess=F(S=>{const I=b.result;if(!I)return void m(null);I.___id=++Zi,I.done=!1;const C=I.continue.bind(I);let O=I.continuePrimaryKey;O&&(O=O.bind(I));const $=I.advance.bind(I),H=()=>{throw new Error("Cursor not stopped")};I.trans=f,I.stop=I.continue=I.continuePrimaryKey=I.advance=()=>{throw new Error("Cursor not started")},I.fail=F(g),I.next=function(){let U=1;return this.start(()=>U--?this.continue():this.stop()).then(()=>this)},I.start=U=>{const st=new Promise((q,Y)=>{q=F(q),b.onerror=at(Y),I.fail=Y,I.stop=K=>{I.stop=I.continue=I.continuePrimaryKey=I.advance=H,q(K)}}),G=()=>{if(b.result)try{U()}catch(q){I.fail(q)}else I.done=!0,I.start=()=>{throw new Error("Cursor behind last entry")},I.stop()};return b.onsuccess=F(q=>{b.onsuccess=G,G()}),I.continue=C,I.continuePrimaryKey=O,I.advance=$,G(),st},m(I)},g)})},count({query:f,trans:h}){const{index:d,range:_}=f;return new Promise((y,m)=>{const g=h.objectStore(l),p=d.isPrimaryKey?g:g.index(d.name),E=r(_),T=E?p.count(E):p.count();T.onsuccess=F(L=>y(L.target.result)),T.onerror=at(m)})}}}(u)),a={};return o.forEach(u=>a[u.name]=u),{stack:"dbcore",transaction:t.transaction.bind(t),table(u){if(!a[u])throw new Error(`Table '${u}' not found`);return a[u]},MIN_KEY:-1/0,MAX_KEY:le(e),schema:i}}function Nn({_novip:t},e){const n=e.db,r=function(i,s,{IDBKeyRange:o,indexedDB:a},u){return{dbcore:function(l,f){return f.reduce((h,{create:d})=>({...h,...d(h)}),l)}(Yi(s,o,u),i.dbcore)}}(t._middlewares,n,t._deps,e);t.core=r.dbcore,t.tables.forEach(i=>{const s=i.name;t.core.schema.tables.some(o=>o.name===s)&&(i.core=t.core.table(s),t[s]instanceof t.Table&&(t[s].core=i.core))})}function Be({_novip:t},e,n,r){n.forEach(i=>{const s=r[i];e.forEach(o=>{const a=ze(o,i);(!a||"value"in a&&a.value===void 0)&&(o===t.Transaction.prototype||o instanceof t.Transaction?ut(o,i,{get(){return this.table(i)},set(u){tr(this,i,{value:u,writable:!0,configurable:!0,enumerable:!0})}}):o[i]=new t.Table(i,s))})})}function wn({_novip:t},e){e.forEach(n=>{for(let r in n)n[r]instanceof t.Table&&delete n[r]})}function Wi(t,e){return t._cfg.version-e._cfg.version}function zi(t,e,n,r){const i=t._dbSchema,s=t._createTransaction("readwrite",t._storeNames,i);s.create(n),s._completion.catch(r);const o=s._reject.bind(s),a=w.transless||w;Et(()=>{w.trans=s,w.transless=a,e===0?(V(i).forEach(u=>{Sn(n,u,i[u].primKey,i[u].indexes)}),Nn(t,n),N.follow(()=>t.on.populate.fire(s)).catch(o)):function({_novip:u},c,l,f){const h=[],d=u._versions;let _=u._dbSchema=xn(u,u.idbdb,f),y=!1;const m=d.filter(p=>p._cfg.version>=c);function g(){return h.length?N.resolve(h.shift()(l.idbtrans)).then(g):N.resolve()}return m.forEach(p=>{h.push(()=>{const E=_,T=p._cfg.dbschema;Cn(u,E,f),Cn(u,T,f),_=u._dbSchema=T;const L=Ur(E,T);L.add.forEach(b=>{Sn(f,b[0],b[1].primKey,b[1].indexes)}),L.change.forEach(b=>{if(b.recreate)throw new P.Upgrade("Not yet support for changing primary key");{const S=f.objectStore(b.name);b.add.forEach(I=>Pn(S,I)),b.change.forEach(I=>{S.deleteIndex(I.name),Pn(S,I)}),b.del.forEach(I=>S.deleteIndex(I))}});const R=p._cfg.contentUpgrade;if(R&&p._cfg.version>c){Nn(u,f),l._memoizedTables={},y=!0;let b=ir(T);L.del.forEach(O=>{b[O]=E[O]}),wn(u,[u.Transaction.prototype]),Be(u,[u.Transaction.prototype],V(b),b),l.schema=b;const S=tn(R);let I;S&&Gt();const C=N.follow(()=>{if(I=R(l),I&&S){var O=ht.bind(null,null);I.then(O,O)}});return I&&typeof I.then=="function"?N.resolve(I):C.then(()=>I)}}),h.push(E=>{(!y||!Fi)&&function(T,L){[].slice.call(L.db.objectStoreNames).forEach(R=>T[R]==null&&L.db.deleteObjectStore(R))}(p._cfg.dbschema,E),wn(u,[u.Transaction.prototype]),Be(u,[u.Transaction.prototype],u._storeNames,u._dbSchema),l.schema=u._dbSchema})}),g().then(()=>{var p,E;E=f,V(p=_).forEach(T=>{E.db.objectStoreNames.contains(T)||Sn(E,T,p[T].primKey,p[T].indexes)})})}(t,e,s,n).catch(o)})}function Ur(t,e){const n={del:[],add:[],change:[]};let r;for(r in t)e[r]||n.del.push(r);for(r in e){const i=t[r],s=e[r];if(i){const o={name:r,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!Ce)o.recreate=!0,n.change.push(o);else{const a=i.idxByName,u=s.idxByName;let c;for(c in a)u[c]||o.del.push(c);for(c in u){const l=a[c],f=u[c];l?l.src!==f.src&&o.change.push(f):o.add.push(f)}(o.del.length>0||o.add.length>0||o.change.length>0)&&n.change.push(o)}}else n.add.push([r,s])}return n}function Sn(t,e,n,r){const i=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(s=>Pn(i,s)),i}function Pn(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function xn(t,e,n){const r={};return Ee(e.objectStoreNames,0).forEach(i=>{const s=n.objectStore(i);let o=s.keyPath;const a=vn(Mr(o),o||"",!1,!1,!!s.autoIncrement,o&&typeof o!="string",!0),u=[];for(let l=0;l<s.indexNames.length;++l){const f=s.index(s.indexNames[l]);o=f.keyPath;var c=vn(f.name,o,!!f.unique,!!f.multiEntry,!1,o&&typeof o!="string",!1);u.push(c)}r[i]=kr(i,a,u)}),r}function Cn({_novip:t},e,n){const r=n.db.objectStoreNames;for(let i=0;i<r.length;++i){const s=r[i],o=n.objectStore(s);t._hasGetAll="getAll"in o;for(let a=0;a<o.indexNames.length;++a){const u=o.indexNames[a],c=o.index(u).keyPath,l=typeof c=="string"?c:"["+Ee(c).join("+")+"]";if(e[s]){const f=e[s].idxByName[l];f&&(f.name=u,delete e[s].idxByName[l],e[s].idxByName[u]=f)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&B.WorkerGlobalScope&&B instanceof B.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}class Ji{_parseStoresSpec(e,n){V(e).forEach(r=>{if(e[r]!==null){var i=e[r].split(",").map((o,a)=>{const u=(o=o.trim()).replace(/([&*]|\+\+)/g,""),c=/^\[/.test(u)?u.match(/^\[(.*)\]$/)[1].split("+"):u;return vn(u,c||null,/\&/.test(o),/\*/.test(o),/\+\+/.test(o),z(c),a===0)}),s=i.shift();if(s.multi)throw new P.Schema("Primary key cannot be multi-valued");i.forEach(o=>{if(o.auto)throw new P.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new P.Schema("Index must have a name and cannot be an empty string")}),n[r]=kr(r,s,i)}})}stores(e){const n=this.db;this._cfg.storesSource=this._cfg.storesSource?Q(this._cfg.storesSource,e):e;const r=n._versions,i={};let s={};return r.forEach(o=>{Q(i,o._cfg.storesSource),s=o._cfg.dbschema={},o._parseStoresSpec(i,s)}),n._dbSchema=s,wn(n,[n._allTables,n,n.Transaction.prototype]),Be(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],V(s),s),n._storeNames=V(s),this}upgrade(e){return this._cfg.contentUpgrade=sn(this._cfg.contentUpgrade||M,e),this}}function On(t,e){let n=t._dbNamesDB;return n||(n=t._dbNamesDB=new bt(Oe,{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function Mn(t){return t&&typeof t.databases=="function"}function kn(t){return Et(function(){return w.letThrough=!0,t()})}function Qi(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var n=function(){return indexedDB.databases().finally(e)};t=setInterval(n,100),n()}).finally(function(){return clearInterval(t)}):Promise.resolve()}function Xi(t){const e=t._state,{indexedDB:n}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?Z(e.dbOpenError):t);ot&&(e.openCanceller._stackHolder=Rt()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const r=e.openCanceller;function i(){if(e.openCanceller!==r)throw new P.DatabaseClosed("db.open() was cancelled")}let s=e.dbReadyResolve,o=null,a=!1;const u=()=>new N((c,l)=>{if(i(),!n)throw new P.MissingAPI;const f=t.name,h=e.autoSchema?n.open(f):n.open(f,Math.round(10*t.verno));if(!h)throw new P.MissingAPI;h.onerror=at(l),h.onblocked=F(t._fireOnBlocked),h.onupgradeneeded=F(d=>{if(o=h.transaction,e.autoSchema&&!t._options.allowEmptyDB){h.onerror=ae,o.abort(),h.result.close();const y=n.deleteDatabase(f);y.onsuccess=y.onerror=F(()=>{l(new P.NoSuchDatabase(`Database ${f} doesnt exist`))})}else{o.onerror=at(l);var _=d.oldVersion>Math.pow(2,62)?0:d.oldVersion;a=_<1,t._novip.idbdb=h.result,zi(t,_/10,o,l)}},l),h.onsuccess=F(()=>{o=null;const d=t._novip.idbdb=h.result,_=Ee(d.objectStoreNames);if(_.length>0)try{const m=d.transaction((y=_).length===1?y[0]:y,"readonly");e.autoSchema?function({_novip:g},p,E){g.verno=p.version/10;const T=g._dbSchema=xn(0,p,E);g._storeNames=Ee(p.objectStoreNames,0),Be(g,[g._allTables],V(T),T)}(t,d,m):(Cn(t,t._dbSchema,m),function(g,p){const E=Ur(xn(0,g.idbdb,p),g._dbSchema);return!(E.add.length||E.change.some(T=>T.add.length||T.change.length))}(t,m)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Nn(t,m)}catch{}var y;ie.push(t),d.onversionchange=F(m=>{e.vcFired=!0,t.on("versionchange").fire(m)}),d.onclose=F(m=>{t.on("close").fire(m)}),a&&function({indexedDB:m,IDBKeyRange:g},p){!Mn(m)&&p!==Oe&&On(m,g).put({name:p}).catch(M)}(t._deps,f),c()},l)}).catch(c=>c&&c.name==="UnknownError"&&e.PR1398_maxLoop>0?(e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),u()):N.reject(c));return N.race([r,(typeof navigator>"u"?N.resolve():Qi()).then(u)]).then(()=>(i(),e.onReadyBeingFired=[],N.resolve(kn(()=>t.on.ready.fire(t.vip))).then(function c(){if(e.onReadyBeingFired.length>0){let l=e.onReadyBeingFired.reduce(sn,M);return e.onReadyBeingFired=[],N.resolve(kn(()=>l(t.vip))).then(c)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>t).catch(c=>{e.dbOpenError=c;try{o&&o.abort()}catch{}return r===e.openCanceller&&t._close(),Z(c)}).finally(()=>{e.openComplete=!0,s()})}function Dn(t){var e=s=>t.next(s),n=i(e),r=i(s=>t.throw(s));function i(s){return o=>{var a=s(o),u=a.value;return a.done?u:u&&typeof u.then=="function"?u.then(n,r):z(u)?Promise.all(u).then(n,r):n(u)}}return i(e)()}function ts(t,e,n){var r=arguments.length;if(r<2)throw new P.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];return n=i.pop(),[t,sr(i),n]}function Br(t,e,n,r,i){return N.resolve().then(()=>{const s=w.transless||w,o=t._createTransaction(e,n,t._dbSchema,r),a={trans:o,transless:s};if(r)o.idbtrans=r.idbtrans;else try{o.create(),t._state.PR1398_maxLoop=3}catch(f){return f.name===rn.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Br(t,e,n,null,i))):Z(f)}const u=tn(i);let c;u&&Gt();const l=N.follow(()=>{if(c=i.call(o,o),c)if(u){var f=ht.bind(null,null);c.then(f,f)}else typeof c.next=="function"&&typeof c.throw=="function"&&(c=Dn(c))},a);return(c&&typeof c.then=="function"?N.resolve(c).then(f=>o.active?f:Z(new P.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):l.then(()=>c)).then(f=>(r&&o._resolve(),o._completion.then(()=>f))).catch(f=>(o._reject(f),Z(f)))})}function Fe(t,e,n){const r=z(t)?t.slice():[t];for(let i=0;i<n;++i)r.push(e);return r}const es={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return{...t,table(e){const n=t.table(e),{schema:r}=n,i={},s=[];function o(l,f,h){const d=ce(l),_=i[d]=i[d]||[],y=l==null?0:typeof l=="string"?1:l.length,m=f>0,g={...h,isVirtual:m,keyTail:f,keyLength:y,extractKey:Rn(l),unique:!m&&h.unique};return _.push(g),g.isPrimaryKey||s.push(g),y>1&&o(y===2?l[0]:l.slice(0,y-1),f+1,h),_.sort((p,E)=>p.keyTail-E.keyTail),g}const a=o(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[a];for(const l of r.indexes)o(l.keyPath,0,l);function u(l){const f=l.query.index;return f.isVirtual?{...l,query:{index:f,range:(h=l.query.range,d=f.keyTail,{type:h.type===1?2:h.type,lower:Fe(h.lower,h.lowerOpen?t.MAX_KEY:t.MIN_KEY,d),lowerOpen:!0,upper:Fe(h.upper,h.upperOpen?t.MIN_KEY:t.MAX_KEY,d),upperOpen:!0})}}:l;var h,d}return{...n,schema:{...r,primaryKey:a,indexes:s,getIndexByKeyPath:function(l){const f=i[ce(l)];return f&&f[0]}},count:l=>n.count(u(l)),query:l=>n.query(u(l)),openCursor(l){const{keyTail:f,isVirtual:h,keyLength:d}=l.query.index;return h?n.openCursor(u(l)).then(_=>_&&function(y){return Object.create(y,{continue:{value:function(g){g!=null?y.continue(Fe(g,l.reverse?t.MAX_KEY:t.MIN_KEY,f)):l.unique?y.continue(y.key.slice(0,d).concat(l.reverse?t.MIN_KEY:t.MAX_KEY,f)):y.continue()}},continuePrimaryKey:{value(g,p){y.continuePrimaryKey(Fe(g,t.MAX_KEY,f),p)}},primaryKey:{get:()=>y.primaryKey},key:{get(){const g=y.key;return d===1?g[0]:g.slice(0,d)}},value:{get:()=>y.value}})}(_)):n.openCursor(l)}}}}}};function Un(t,e,n,r){return n=n||{},r=r||"",V(t).forEach(i=>{if(et(e,i)){var s=t[i],o=e[i];if(typeof s=="object"&&typeof o=="object"&&s&&o){const a=Qe(s);a!==Qe(o)?n[r+i]=e[i]:a==="Object"?Un(s,o,n,r+i+"."):s!==o&&(n[r+i]=e[i])}else s!==o&&(n[r+i]=e[i])}else n[r+i]=void 0}),V(e).forEach(i=>{et(t,i)||(n[r+i]=e[i])}),n}const ns={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){const n=t.table(e),{primaryKey:r}=n.schema;return{...n,mutate(s){const o=w.trans,{deleting:a,creating:u,updating:c}=o.table(e).hook;switch(s.type){case"add":if(u.fire===M)break;return o._promise("readwrite",()=>l(s),!0);case"put":if(u.fire===M&&c.fire===M)break;return o._promise("readwrite",()=>l(s),!0);case"delete":if(a.fire===M)break;return o._promise("readwrite",()=>l(s),!0);case"deleteRange":if(a.fire===M)break;return o._promise("readwrite",()=>function(h){return f(h.trans,h.range,1e4)}(s),!0)}return n.mutate(s);function l(h){const d=w.trans,_=h.keys||function(y,m){return m.type==="delete"?m.keys:m.keys||m.values.map(y.extractKey)}(r,h);if(!_)throw new Error("Keys missing");return(h=h.type==="add"||h.type==="put"?{...h,keys:_}:{...h}).type!=="delete"&&(h.values=[...h.values]),h.keys&&(h.keys=[...h.keys]),function(y,m,g){return m.type==="add"?Promise.resolve([]):y.getMany({trans:m.trans,keys:g,cache:"immutable"})}(n,h,_).then(y=>{const m=_.map((g,p)=>{const E=y[p],T={onerror:null,onsuccess:null};if(h.type==="delete")a.fire.call(T,g,E,d);else if(h.type==="add"||E===void 0){const L=u.fire.call(T,g,h.values[p],d);g==null&&L!=null&&(g=L,h.keys[p]=g,r.outbound||it(h.values[p],r.keyPath,g))}else{const L=Un(E,h.values[p]),R=c.fire.call(T,L,g,E,d);if(R){const b=h.values[p];Object.keys(R).forEach(S=>{et(b,S)?b[S]=R[S]:it(b,S,R[S])})}}return T});return n.mutate(h).then(({failures:g,results:p,numFailures:E,lastResult:T})=>{for(let L=0;L<_.length;++L){const R=p?p[L]:_[L],b=m[L];R==null?b.onerror&&b.onerror(g[L]):b.onsuccess&&b.onsuccess(h.type==="put"&&y[L]?h.values[L]:R)}return{failures:g,results:p,numFailures:E,lastResult:T}}).catch(g=>(m.forEach(p=>p.onerror&&p.onerror(g)),Promise.reject(g)))})}function f(h,d,_){return n.query({trans:h,values:!1,query:{index:r,range:d},limit:_}).then(({result:y})=>l({type:"delete",keys:y,trans:h}).then(m=>m.numFailures>0?Promise.reject(m.failures[0]):y.length<_?{failures:[],numFailures:0,lastResult:void 0}:f(h,{...d,lower:y[y.length-1],lowerOpen:!0},_)))}}}}})};function Fr(t,e,n){try{if(!e||e.keys.length<t.length)return null;const r=[];for(let i=0,s=0;i<e.keys.length&&s<t.length;++i)X(e.keys[i],t[s])===0&&(r.push(n?zt(e.values[i]):e.values[i]),++s);return r.length===t.length?r:null}catch{return null}}const rs={stack:"dbcore",level:-1,create:t=>({table:e=>{const n=t.table(e);return{...n,getMany:r=>{if(!r.cache)return n.getMany(r);const i=Fr(r.keys,r.trans._cache,r.cache==="clone");return i?N.resolve(i):n.getMany(r).then(s=>(r.trans._cache={keys:r.keys,values:r.cache==="clone"?zt(s):s},s))},mutate:r=>(r.type!=="add"&&(r.trans._cache=null),n.mutate(r))}}})};function Bn(t){return!("from"in t)}const dt=function(t,e){if(!this){const n=new dt;return t&&"d"in t&&Q(n,t),n}Q(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0})};function he(t,e,n){const r=X(e,n);if(isNaN(r))return;if(r>0)throw RangeError();if(Bn(t))return Q(t,{from:e,to:n,d:1});const i=t.l,s=t.r;if(X(n,t.from)<0)return i?he(i,e,n):t.l={from:e,to:n,d:1,l:null,r:null},Gr(t);if(X(e,t.to)>0)return s?he(s,e,n):t.r={from:e,to:n,d:1,l:null,r:null},Gr(t);X(e,t.from)<0&&(t.from=e,t.l=null,t.d=s?s.d+1:1),X(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);const o=!t.r;i&&!t.l&&Ge(t,i),s&&o&&Ge(t,s)}function Ge(t,e){Bn(e)||function n(r,{from:i,to:s,l:o,r:a}){he(r,i,s),o&&n(r,o),a&&n(r,a)}(t,e)}function is(t,e){const n=Fn(e);let r=n.next();if(r.done)return!1;let i=r.value;const s=Fn(t);let o=s.next(i.from),a=o.value;for(;!r.done&&!o.done;){if(X(a.from,i.to)<=0&&X(a.to,i.from)>=0)return!0;X(i.from,a.from)<0?i=(r=n.next(a.from)).value:a=(o=s.next(i.from)).value}return!1}function Fn(t){let e=Bn(t)?null:{s:0,n:t};return{next(n){const r=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&X(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||X(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Gr(t){var e,n;const r=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((n=t.l)===null||n===void 0?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){const s=i==="r"?"l":"r",o={...t},a=t[i];t.from=a.from,t.to=a.to,t[i]=a[i],o[i]=a[s],t[s]=o,o.d=Kr(o)}t.d=Kr(t)}function Kr({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}kt(dt.prototype,{add(t){return Ge(this,t),this},addKey(t){return he(this,t,t),this},addKeys(t){return t.forEach(e=>he(this,e,e)),this},[Xe](){return Fn(this)}});const ss={stack:"dbcore",level:0,create:t=>{const e=t.schema.name,n=new dt(t.MIN_KEY,t.MAX_KEY);return{...t,table:r=>{const i=t.table(r),{schema:s}=i,{primaryKey:o}=s,{extractKey:a,outbound:u}=o,c={...i,mutate:h=>{const d=h.trans,_=d.mutatedParts||(d.mutatedParts={}),y=R=>{const b=`idb://${e}/${r}/${R}`;return _[b]||(_[b]=new dt)},m=y(""),g=y(":dels"),{type:p}=h;let[E,T]=h.type==="deleteRange"?[h.range]:h.type==="delete"?[h.keys]:h.values.length<50?[[],h.values]:[];const L=h.trans._cache;return i.mutate(h).then(R=>{if(z(E)){p!=="delete"&&(E=R.results),m.addKeys(E);const b=Fr(E,L);b||p==="add"||g.addKeys(E),(b||T)&&function(S,I,C,O){function $(H){const U=S(H.name||"");function st(q){return q!=null?H.extractKey(q):null}const G=q=>H.multiEntry&&z(q)?q.forEach(Y=>U.addKey(Y)):U.addKey(q);(C||O).forEach((q,Y)=>{const K=C&&st(C[Y]),D=O&&st(O[Y]);X(K,D)!==0&&(K!=null&&G(K),D!=null&&G(D))})}I.indexes.forEach($)}(y,s,b,T)}else if(E){const b={from:E.lower,to:E.upper};g.add(b),m.add(b)}else m.add(n),g.add(n),s.indexes.forEach(b=>y(b.name).add(n));return R})}},l=({query:{index:h,range:d}})=>{var _,y;return[h,new dt((_=d.lower)!==null&&_!==void 0?_:t.MIN_KEY,(y=d.upper)!==null&&y!==void 0?y:t.MAX_KEY)]},f={get:h=>[o,new dt(h.key)],getMany:h=>[o,new dt().addKeys(h.keys)],count:l,query:l,openCursor:l};return V(f).forEach(h=>{c[h]=function(d){const{subscr:_}=w;if(_){const y=T=>{const L=`idb://${e}/${r}/${T}`;return _[L]||(_[L]=new dt)},m=y(""),g=y(":dels"),[p,E]=f[h](d);if(y(p.name||"").add(E),!p.isPrimaryKey){if(h!=="count"){const T=h==="query"&&u&&d.values&&i.query({...d,values:!1});return i[h].apply(this,arguments).then(L=>{if(h==="query"){if(u&&d.values)return T.then(({result:b})=>(m.addKeys(b),L));const R=d.values?L.result.map(a):L.result;d.values?m.addKeys(R):g.addKeys(R)}else if(h==="openCursor"){const R=L,b=d.values;return R&&Object.create(R,{key:{get:()=>(g.addKey(R.primaryKey),R.key)},primaryKey:{get(){const S=R.primaryKey;return g.addKey(S),S}},value:{get:()=>(b&&m.addKey(R.primaryKey),R.value)}})}return L})}g.add(n)}}return i[h].apply(this,arguments)}}),c}}}};class bt{constructor(e,n){this._middlewares={},this.verno=0;const r=bt.dependencies;this._options=n={addons:bt.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...n},this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};const{addons:i}=n;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:M,dbReadyPromise:null,cancelOpen:M,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var o;s.dbReadyPromise=new N(a=>{s.dbReadyResolve=a}),s.openCanceller=new N((a,u)=>{s.cancelOpen=u}),this._state=s,this.name=e,this.on=se(this,"populate","blocked","versionchange","close",{ready:[sn,M]}),this.on.ready.subscribe=er(this.on.ready.subscribe,a=>(u,c)=>{bt.vip(()=>{const l=this._state;if(l.openComplete)l.dbOpenError||N.resolve().then(u),c&&a(u);else if(l.onReadyBeingFired)l.onReadyBeingFired.push(u),c&&a(u);else{a(u);const f=this;c||a(function h(){f.on.ready.unsubscribe(u),f.on.ready.unsubscribe(h)})}})}),this.Collection=(o=this,oe(ji.prototype,function(a,u){this.db=o;let c=Nr,l=null;if(u)try{c=u()}catch(_){l=_}const f=a._ctx,h=f.table,d=h.hook.reading.fire;this._ctx={table:h,index:f.index,isPrimKey:!f.index||h.schema.primKey.keyPath&&f.index===h.schema.primKey.name,range:c,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:l,or:f.or,valueMapper:d!==Qt?d:null}})),this.Table=function(a){return oe(Ki.prototype,function(u,c,l){this.db=a,this._tx=l,this.name=u,this.schema=c,this.hook=a._allTables[u]?a._allTables[u].hook:se(null,{creating:[Si,M],reading:[wi,Qt],updating:[xi,M],deleting:[Pi,M]})})}(this),this.Transaction=function(a){return oe(qi.prototype,function(u,c,l,f,h){this.db=a,this.mode=u,this.storeNames=c,this.schema=l,this.chromeTransactionDurability=f,this.idbtrans=null,this.on=se(this,"complete","error","abort"),this.parent=h||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new N((d,_)=>{this._resolve=d,this._reject=_}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},d=>{var _=this.active;return this.active=!1,this.on.error.fire(d),this.parent?this.parent._reject(d):_&&this.idbtrans&&this.idbtrans.abort(),Z(d)})})}(this),this.Version=function(a){return oe(Ji.prototype,function(u){this.db=a,this._cfg={version:u,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(a){return oe(Or.prototype,function(u,c,l){this.db=a,this._ctx={table:u,index:c===":id"?null:c,or:l};const f=a._deps.indexedDB;if(!f)throw new P.MissingAPI;this._cmp=this._ascending=f.cmp.bind(f),this._descending=(h,d)=>f.cmp(d,h),this._max=(h,d)=>f.cmp(h,d)>0?h:d,this._min=(h,d)=>f.cmp(h,d)<0?h:d,this._IDBKeyRange=a._deps.IDBKeyRange})}(this),this.on("versionchange",a=>{a.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",a=>{!a.newVersion||a.newVersion<a.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${a.oldVersion/10}`)}),this._maxKey=le(n.IDBKeyRange),this._createTransaction=(a,u,c,l)=>new this.Transaction(a,u,c,this._options.chromeTransactionDurability,l),this._fireOnBlocked=a=>{this.on("blocked").fire(a),ie.filter(u=>u.name===this.name&&u!==this&&!u._state.vcFired).map(u=>u.on("versionchange").fire(a))},this.use(es),this.use(ns),this.use(ss),this.use(rs),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(a=>a(this))}version(e){if(isNaN(e)||e<.1)throw new P.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new P.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const n=this._versions;var r=n.filter(i=>i._cfg.version===e)[0];return r||(r=new this.Version(e),n.push(r),n.sort(Wi),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||w.letThrough||this._vip)?e():new N((n,r)=>{if(this._state.openComplete)return r(new P.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void r(new P.DatabaseClosed);this.open().catch(M)}this._state.dbReadyPromise.then(n,r)}).then(e)}use({stack:e,create:n,level:r,name:i}){i&&this.unuse({stack:e,name:i});const s=this._middlewares[e]||(this._middlewares[e]=[]);return s.push({stack:e,create:n,level:r??10,name:i}),s.sort((o,a)=>o.level-a.level),this}unuse({stack:e,name:n,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(i=>r?i.create!==r:!!n&&i.name!==n)),this}open(){return Xi(this)}_close(){const e=this._state,n=ie.indexOf(this);if(n>=0&&ie.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new N(r=>{e.dbReadyResolve=r}),e.openCanceller=new N((r,i)=>{e.cancelOpen=i})}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new P.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,n=this._state;return new N((r,i)=>{const s=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=F(()=>{(function({indexedDB:a,IDBKeyRange:u},c){!Mn(a)&&c!==Oe&&On(a,u).delete(c).catch(M)})(this._deps,this.name),r()}),o.onerror=at(i),o.onblocked=this._fireOnBlocked};if(e)throw new P.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(s):s()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return V(this._allTables).map(e=>this._allTables[e])}transaction(){const e=ts.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,n,r){let i=w.trans;i&&i.db===this&&e.indexOf("!")===-1||(i=null);const s=e.indexOf("?")!==-1;let o,a;e=e.replace("!","").replace("?","");try{if(a=n.map(c=>{var l=c instanceof this.Table?c.name:c;if(typeof l!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return l}),e=="r"||e===Tn)o=Tn;else{if(e!="rw"&&e!=An)throw new P.InvalidArgument("Invalid transaction mode: "+e);o=An}if(i){if(i.mode===Tn&&o===An){if(!s)throw new P.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&a.forEach(c=>{if(i&&i.storeNames.indexOf(c)===-1){if(!s)throw new P.SubTransaction("Table "+c+" not included in parent transaction.");i=null}}),s&&i&&!i.active&&(i=null)}}catch(c){return i?i._promise(null,(l,f)=>{f(c)}):Z(c)}const u=Br.bind(null,this,o,a,i,r);return i?i._promise(o,u,"lock"):w.trans?Kt(w.transless,()=>this._whenReady(u)):this._whenReady(u)}table(e){if(!et(this._allTables,e))throw new P.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const os=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class as{constructor(e){this._subscribe=e}subscribe(e,n,r){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:n,complete:r})}[os](){return this}}function jr(t,e){return V(e).forEach(n=>{Ge(t[n]||(t[n]=new dt),e[n])}),t}function us(t){let e,n=!1;const r=new as(i=>{const s=tn(t);let o=!1,a={},u={};const c={get closed(){return o},unsubscribe:()=>{o=!0,It.storagemutated.unsubscribe(d)}};i.start&&i.start(c);let l=!1,f=!1;function h(){return V(u).some(y=>a[y]&&is(a[y],u[y]))}const d=y=>{jr(a,y),h()&&_()},_=()=>{if(l||o)return;a={};const y={},m=function(g){s&&Gt();const p=()=>Et(t,{subscr:g,trans:null}),E=w.trans?Kt(w.transless,p):p();return s&&E.then(ht,ht),E}(y);f||(It(ue,d),f=!0),l=!0,Promise.resolve(m).then(g=>{n=!0,e=g,l=!1,o||(h()?_():(a={},u=y,i.next&&i.next(g)))},g=>{l=!1,n=!1,i.error&&i.error(g),c.unsubscribe()})};return _(),c});return r.hasValue=()=>n,r.getValue=()=>e,r}let Gn;try{Gn={indexedDB:B.indexedDB||B.mozIndexedDB||B.webkitIndexedDB||B.msIndexedDB,IDBKeyRange:B.IDBKeyRange||B.webkitIDBKeyRange}}catch{Gn={indexedDB:null,IDBKeyRange:null}}const Ct=bt;function Ke(t){let e=_t;try{_t=!0,It.storagemutated.fire(t)}finally{_t=e}}kt(Ct,{...Te,delete:t=>new Ct(t,{addons:[]}).delete(),exists:t=>new Ct(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(t){try{return function({indexedDB:e,IDBKeyRange:n}){return Mn(e)?Promise.resolve(e.databases()).then(r=>r.map(i=>i.name).filter(i=>i!==Oe)):On(e,n).toCollection().primaryKeys()}(Ct.dependencies).then(t)}catch{return Z(new P.MissingAPI)}},defineClass:()=>function(t){Q(this,t)},ignoreTransaction:t=>w.trans?Kt(w.transless,t):t(),vip:kn,async:function(t){return function(){try{var e=Dn(t.apply(this,arguments));return e&&typeof e.then=="function"?e:N.resolve(e)}catch(n){return Z(n)}}},spawn:function(t,e,n){try{var r=Dn(t.apply(n,e||[]));return r&&typeof r.then=="function"?r:N.resolve(r)}catch(i){return Z(i)}},currentTransaction:{get:()=>w.trans||null},waitFor:function(t,e){const n=N.resolve(typeof t=="function"?Ct.ignoreTransaction(t):t).timeout(e||6e4);return w.trans?w.trans.waitFor(n):n},Promise:N,debug:{get:()=>ot,set:t=>{ar(t,t==="dexie"?()=>!0:Rr)}},derive:Dt,extend:Q,props:kt,override:er,Events:se,on:It,liveQuery:us,extendObservabilitySet:jr,getByKeyPath:lt,setByKeyPath:it,delByKeyPath:function(t,e){typeof e=="string"?it(t,e,void 0):"length"in e&&[].map.call(e,function(n){it(t,n,void 0)})},shallowClone:ir,deepClone:zt,getObjectDiff:Un,cmp:X,asap:nr,minKey:mn,addons:[],connections:ie,errnames:rn,dependencies:Gn,semVer:Lr,version:Lr.split(".").map(t=>parseInt(t)).reduce((t,e,n)=>t+e/Math.pow(10,2*n))}),Ct.maxKey=le(Ct.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(It(ue,t=>{if(!_t){let e;Ce?(e=document.createEvent("CustomEvent"),e.initCustomEvent(At,!0,!0,t)):e=new CustomEvent(At,{detail:t}),_t=!0,dispatchEvent(e),_t=!1}}),addEventListener(At,({detail:t})=>{_t||Ke(t)}));let _t=!1;if(typeof BroadcastChannel<"u"){const t=new BroadcastChannel(At);typeof t.unref=="function"&&t.unref(),It(ue,e=>{_t||t.postMessage(e)}),t.onmessage=e=>{e.data&&Ke(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){It(ue,e=>{try{_t||(typeof localStorage<"u"&&localStorage.setItem(At,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(n=>n.postMessage({type:At,changedParts:e})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",e=>{if(e.key===At){const n=JSON.parse(e.newValue);n&&Ke(n.changedParts)}});const t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",function({data:e}){e&&e.type===At&&Ke(e.changedParts)})}N.rejectionMapper=function(t,e){if(!t||t instanceof Bt||t instanceof TypeError||t instanceof SyntaxError||!t.name||!hr[t.name])return t;var n=new hr[t.name](e||t.message,t);return"stack"in t&&ut(n,"stack",{get:function(){return this.inner.stack}}),n},ar(ot,Rr);const $r="Spatialec",Vr=$r+"_Resources",Hr=$r+"_Projects",Vt={resources:"resources",projects:"projects"},yt=class yt extends bt{constructor(e){super(e),this.version(14).stores({layerPanelState:"++id",layoutState:"++id, &i"}),this.layerPanelState=this.table(yt.layerPanelState),this.layerPanelState.toArray().then(n=>{n.length===0&&this.layerPanelState.add({mapTileUuid:"",gadmGeoJsonUuid:[],mapTileEnabled:!0,gadmGeoJsonEnabled:!0})}),this.layoutState=this.table(yt.layoutState)}static async saveComponentState(e,n){const r=n.map((s,o)=>({...s,zIndex:o})),i=await yt.openProject(e);i.transaction("rw",i.layoutState,async()=>{await i.layoutState.clear(),await i.layoutState.bulkAdd(r)})}static async getComponentState(e){return await(await yt.openProject(e)).layoutState.toArray()}async getLayerPanelState(){const e=await this.layerPanelState.toArray();if(e&&e.length>0)return e[0]}async getComponentState(e){return await this.layoutState.where("name").equals(e).last()}async updateComponentState(e,n){await this.layoutState.where("name").equals(e).modify(n)}async updateLayerPanelState(e){const n=(await this.layerPanelState.toArray())[0];await this.layerPanelState.update(n,e).then(function(r){console.log(r?"updated":"Nothing was updated",n,e,r)})}static fileNameOf(e,n){switch(e){case Vt.resources:return`${Vr}-${n}`;case Vt.projects:return`${Hr}-${n}`;default:throw new Error("invalid type:"+e)}}static async openProject(e){return new yt(this.fileNameOf(Vt.projects,e))}};yt.layerPanelState="layerPanelState",yt.layoutState="layoutState";let Kn=yt;const qr=24;function ls(t){const e=new ArrayBuffer(t.length*qr),n=new DataView(e);return t.forEach((r,i)=>{const s=i*qr;n.setFloat32(s,r.centerPosition[0],!0),n.setFloat32(s+4,r.centerPosition[1],!0),n.setFloat32(s+8,r.radius,!0),n.setFloat32(s+12,r.strokeWidth,!0),n.setUint8(s+16,r.strokeColor[0]),n.setUint8(s+17,r.strokeColor[1]),n.setUint8(s+18,r.strokeColor[2]),n.setUint8(s+19,r.strokeColor[3]??255),n.setUint8(s+20,r.fillColor[0]),n.setUint8(s+21,r.fillColor[1]),n.setUint8(s+22,r.fillColor[2]),n.setUint8(s+23,r.fillColor[3]??255)}),e}const Zr=4,Yr=24;function cs(t,e){const n=new ArrayBuffer(t.length*Zr),r=new DataView(n),i=new ArrayBuffer(t.length*Yr),s=new DataView(i);return t.forEach((o,a)=>{const u=e.get(o.sourcePositionIDRef),c=e.get(o.targetPositionIDRef);if(u&&c){const l=a*Yr;r.setUint32(a*Zr,l,!0),s.setFloat32(l,u[0],!0),s.setFloat32(l+4,u[1],!0),s.setFloat32(l+8,c[0],!0),s.setFloat32(l+12,c[1],!0),s.setFloat32(l+16,o.strokeWidth,!0),s.setUint8(l+20,o.strokeColor[0]),s.setUint8(l+21,o.strokeColor[1]),s.setUint8(l+22,o.strokeColor[2]),s.setUint8(l+23,o.strokeColor[3]??255)}else throw new Error("Error line:"+a)}),{buffer:i,indices:n}}const hs=4*2,Wr=4;function fs(t){let e=0,n=0;t.forEach(g=>{g.coordinates.forEach((p,E)=>{p.forEach(T=>{e+=T.length,n++})})});const r=new ArrayBuffer(e*hs),i=new ArrayBuffer(t.length*Wr),s=new ArrayBuffer(n*Wr),o=new ArrayBuffer(t.length*4),a=new ArrayBuffer(t.length*4),u=new ArrayBuffer(t.length*4),c=new Float32Array(r),l=new Uint32Array(i),f=new Uint32Array(s),h=new Float32Array(o),d=new Uint8Array(a),_=new Uint8Array(u);let y=0,m=0;return t.forEach((g,p)=>{l[p]=m,g.coordinates.forEach(E=>{E.forEach((T,L)=>{L==0?(f[y++]=m,T.forEach(([R,b])=>{c[m++]=R,c[m++]=b})):console.log("ringIndex="+L+" is not 0, skipping...")})}),h[p]=g.strokeWidth,d[p*4+0]=g.strokeColor[0],d[p*4+1]=g.strokeColor[1],d[p*4+2]=g.strokeColor[2],d[p*4+3]=g.strokeColor[3]??255,_[p*4+0]=g.fillColor[0],_[p*4+1]=g.fillColor[1],_[p*4+2]=g.fillColor[2],_[p*4+3]=g.fillColor[3]??255}),{positions:r,polygonIndices:i,pathIndices:s,lineWidths:o,lineColors:a,fillColors:u}}function ds(t){const e=new Map;return t.forEach(n=>{e.set(n.id.toString(),n.centerPosition)}),e}const Lt="z0, z1, z2, z3, z4, z5, z6, z7, z8, z9, z10",Ot="z0_, z1_, z2_, z3_, z4_, z5_, z6_, z7_, z8_, z9_, z10_",zr=.05,Ht=10,Jr={NOT_CONTAINED:-1},je=256;function $e(t,e){let n=Math.sin(t.lat*Math.PI/180);n=Math.min(Math.max(n,-.9999),.9999);const r=je*(.5+t.lng/360)*Math.pow(2,e),i=je*(.5-Math.log((1+n)/(1-n))/(4*Math.PI))*Math.pow(2,e);return{x:r,y:i}}function Ve(t,e){return{x:Math.floor(t.x/je),y:Math.floor(t.y/je),z:e}}function jn({x:t,y:e,z:n}){let r=0;for(let i=0;i<n;i++){const s=1<<i;t&s&&(r|=1<<2*i),e&s&&(r|=1<<2*i+1)}return r}function _s(t,e){let n=Ht;for(;n>0;){const r=Ve($e(t,n),n),i=Ve($e(e,n),n),s=jn(r),o=jn(i);if(s!==o)break;n--}return n}function $n(t,e,n){if(n===void 0&&(n=_s(t,e)),n<0||n>Ht)throw new Error(`Invalid zoom level: ${n}`);if(t.lng>e.lng){const r=Vn(t,{lat:e.lat,lng:180},n),i=Vn({lat:t.lat,lng:-180},e,n);return[r,i]}else return t.lng===-180&&e.lng===180?[[0]]:[Vn(t,e,n)]}function Vn(t,e,n){const r=$e(t,n),i=$e(e,n),s=Ve(r,n),o=Ve(i,n),a=[];for(let u=s.x;u<=o.x;u++)for(let c=s.y;c<=o.y;c++)a.push(jn({x:u,y:c,z:n}));return a}function ps(t,e,n){if(n<0||n>Ht)throw new Error(`Invalid max zoom level: ${n}`);const r={};for(let i=0;i<=n;i++)r[`z${i}`]=$n(t,e,i);return r}let He;const ys=new Uint8Array(16);function gs(){if(!He&&(He=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!He))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return He(ys)}const W=[];for(let t=0;t<256;++t)W.push((t+256).toString(16).slice(1));function Es(t,e=0){return W[t[e+0]]+W[t[e+1]]+W[t[e+2]]+W[t[e+3]]+"-"+W[t[e+4]]+W[t[e+5]]+"-"+W[t[e+6]]+W[t[e+7]]+"-"+W[t[e+8]]+W[t[e+9]]+"-"+W[t[e+10]]+W[t[e+11]]+W[t[e+12]]+W[t[e+13]]+W[t[e+14]]+W[t[e+15]]}var Qr={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function ms(t,e,n){if(Qr.randomUUID&&!e&&!t)return Qr.randomUUID();t=t||{};const r=t.random||(t.rng||gs)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){n=n||0;for(let i=0;i<16;++i)e[n+i]=r[i];return e}return Es(r)}var v;(function(t){t[t.BACKSPACE=8]="BACKSPACE",t[t.FORM_FEED=12]="FORM_FEED",t[t.NEWLINE=10]="NEWLINE",t[t.CARRIAGE_RETURN=13]="CARRIAGE_RETURN",t[t.TAB=9]="TAB",t[t.SPACE=32]="SPACE",t[t.EXCLAMATION_MARK=33]="EXCLAMATION_MARK",t[t.QUOTATION_MARK=34]="QUOTATION_MARK",t[t.NUMBER_SIGN=35]="NUMBER_SIGN",t[t.DOLLAR_SIGN=36]="DOLLAR_SIGN",t[t.PERCENT_SIGN=37]="PERCENT_SIGN",t[t.AMPERSAND=38]="AMPERSAND",t[t.APOSTROPHE=39]="APOSTROPHE",t[t.LEFT_PARENTHESIS=40]="LEFT_PARENTHESIS",t[t.RIGHT_PARENTHESIS=41]="RIGHT_PARENTHESIS",t[t.ASTERISK=42]="ASTERISK",t[t.PLUS_SIGN=43]="PLUS_SIGN",t[t.COMMA=44]="COMMA",t[t.HYPHEN_MINUS=45]="HYPHEN_MINUS",t[t.FULL_STOP=46]="FULL_STOP",t[t.SOLIDUS=47]="SOLIDUS",t[t.DIGIT_ZERO=48]="DIGIT_ZERO",t[t.DIGIT_ONE=49]="DIGIT_ONE",t[t.DIGIT_TWO=50]="DIGIT_TWO",t[t.DIGIT_THREE=51]="DIGIT_THREE",t[t.DIGIT_FOUR=52]="DIGIT_FOUR",t[t.DIGIT_FIVE=53]="DIGIT_FIVE",t[t.DIGIT_SIX=54]="DIGIT_SIX",t[t.DIGIT_SEVEN=55]="DIGIT_SEVEN",t[t.DIGIT_EIGHT=56]="DIGIT_EIGHT",t[t.DIGIT_NINE=57]="DIGIT_NINE",t[t.COLON=58]="COLON",t[t.SEMICOLON=59]="SEMICOLON",t[t.LESS_THAN_SIGN=60]="LESS_THAN_SIGN",t[t.EQUALS_SIGN=61]="EQUALS_SIGN",t[t.GREATER_THAN_SIGN=62]="GREATER_THAN_SIGN",t[t.QUESTION_MARK=63]="QUESTION_MARK",t[t.COMMERCIAL_AT=64]="COMMERCIAL_AT",t[t.LATIN_CAPITAL_LETTER_A=65]="LATIN_CAPITAL_LETTER_A",t[t.LATIN_CAPITAL_LETTER_B=66]="LATIN_CAPITAL_LETTER_B",t[t.LATIN_CAPITAL_LETTER_C=67]="LATIN_CAPITAL_LETTER_C",t[t.LATIN_CAPITAL_LETTER_D=68]="LATIN_CAPITAL_LETTER_D",t[t.LATIN_CAPITAL_LETTER_E=69]="LATIN_CAPITAL_LETTER_E",t[t.LATIN_CAPITAL_LETTER_F=70]="LATIN_CAPITAL_LETTER_F",t[t.LATIN_CAPITAL_LETTER_G=71]="LATIN_CAPITAL_LETTER_G",t[t.LATIN_CAPITAL_LETTER_H=72]="LATIN_CAPITAL_LETTER_H",t[t.LATIN_CAPITAL_LETTER_I=73]="LATIN_CAPITAL_LETTER_I",t[t.LATIN_CAPITAL_LETTER_J=74]="LATIN_CAPITAL_LETTER_J",t[t.LATIN_CAPITAL_LETTER_K=75]="LATIN_CAPITAL_LETTER_K",t[t.LATIN_CAPITAL_LETTER_L=76]="LATIN_CAPITAL_LETTER_L",t[t.LATIN_CAPITAL_LETTER_M=77]="LATIN_CAPITAL_LETTER_M",t[t.LATIN_CAPITAL_LETTER_N=78]="LATIN_CAPITAL_LETTER_N",t[t.LATIN_CAPITAL_LETTER_O=79]="LATIN_CAPITAL_LETTER_O",t[t.LATIN_CAPITAL_LETTER_P=80]="LATIN_CAPITAL_LETTER_P",t[t.LATIN_CAPITAL_LETTER_Q=81]="LATIN_CAPITAL_LETTER_Q",t[t.LATIN_CAPITAL_LETTER_R=82]="LATIN_CAPITAL_LETTER_R",t[t.LATIN_CAPITAL_LETTER_S=83]="LATIN_CAPITAL_LETTER_S",t[t.LATIN_CAPITAL_LETTER_T=84]="LATIN_CAPITAL_LETTER_T",t[t.LATIN_CAPITAL_LETTER_U=85]="LATIN_CAPITAL_LETTER_U",t[t.LATIN_CAPITAL_LETTER_V=86]="LATIN_CAPITAL_LETTER_V",t[t.LATIN_CAPITAL_LETTER_W=87]="LATIN_CAPITAL_LETTER_W",t[t.LATIN_CAPITAL_LETTER_X=88]="LATIN_CAPITAL_LETTER_X",t[t.LATIN_CAPITAL_LETTER_Y=89]="LATIN_CAPITAL_LETTER_Y",t[t.LATIN_CAPITAL_LETTER_Z=90]="LATIN_CAPITAL_LETTER_Z",t[t.LEFT_SQUARE_BRACKET=91]="LEFT_SQUARE_BRACKET",t[t.REVERSE_SOLIDUS=92]="REVERSE_SOLIDUS",t[t.RIGHT_SQUARE_BRACKET=93]="RIGHT_SQUARE_BRACKET",t[t.CIRCUMFLEX_ACCENT=94]="CIRCUMFLEX_ACCENT",t[t.LOW_LINE=95]="LOW_LINE",t[t.GRAVE_ACCENT=96]="GRAVE_ACCENT",t[t.LATIN_SMALL_LETTER_A=97]="LATIN_SMALL_LETTER_A",t[t.LATIN_SMALL_LETTER_B=98]="LATIN_SMALL_LETTER_B",t[t.LATIN_SMALL_LETTER_C=99]="LATIN_SMALL_LETTER_C",t[t.LATIN_SMALL_LETTER_D=100]="LATIN_SMALL_LETTER_D",t[t.LATIN_SMALL_LETTER_E=101]="LATIN_SMALL_LETTER_E",t[t.LATIN_SMALL_LETTER_F=102]="LATIN_SMALL_LETTER_F",t[t.LATIN_SMALL_LETTER_G=103]="LATIN_SMALL_LETTER_G",t[t.LATIN_SMALL_LETTER_H=104]="LATIN_SMALL_LETTER_H",t[t.LATIN_SMALL_LETTER_I=105]="LATIN_SMALL_LETTER_I",t[t.LATIN_SMALL_LETTER_J=106]="LATIN_SMALL_LETTER_J",t[t.LATIN_SMALL_LETTER_K=107]="LATIN_SMALL_LETTER_K",t[t.LATIN_SMALL_LETTER_L=108]="LATIN_SMALL_LETTER_L",t[t.LATIN_SMALL_LETTER_M=109]="LATIN_SMALL_LETTER_M",t[t.LATIN_SMALL_LETTER_N=110]="LATIN_SMALL_LETTER_N",t[t.LATIN_SMALL_LETTER_O=111]="LATIN_SMALL_LETTER_O",t[t.LATIN_SMALL_LETTER_P=112]="LATIN_SMALL_LETTER_P",t[t.LATIN_SMALL_LETTER_Q=113]="LATIN_SMALL_LETTER_Q",t[t.LATIN_SMALL_LETTER_R=114]="LATIN_SMALL_LETTER_R",t[t.LATIN_SMALL_LETTER_S=115]="LATIN_SMALL_LETTER_S",t[t.LATIN_SMALL_LETTER_T=116]="LATIN_SMALL_LETTER_T",t[t.LATIN_SMALL_LETTER_U=117]="LATIN_SMALL_LETTER_U",t[t.LATIN_SMALL_LETTER_V=118]="LATIN_SMALL_LETTER_V",t[t.LATIN_SMALL_LETTER_W=119]="LATIN_SMALL_LETTER_W",t[t.LATIN_SMALL_LETTER_X=120]="LATIN_SMALL_LETTER_X",t[t.LATIN_SMALL_LETTER_Y=121]="LATIN_SMALL_LETTER_Y",t[t.LATIN_SMALL_LETTER_Z=122]="LATIN_SMALL_LETTER_Z",t[t.LEFT_CURLY_BRACKET=123]="LEFT_CURLY_BRACKET",t[t.VERTICAL_LINE=124]="VERTICAL_LINE",t[t.RIGHT_CURLY_BRACKET=125]="RIGHT_CURLY_BRACKET",t[t.TILDE=126]="TILDE"})(v||(v={}));const Ts={[v.QUOTATION_MARK]:v.QUOTATION_MARK,[v.REVERSE_SOLIDUS]:v.REVERSE_SOLIDUS,[v.SOLIDUS]:v.SOLIDUS,[v.LATIN_SMALL_LETTER_B]:v.BACKSPACE,[v.LATIN_SMALL_LETTER_F]:v.FORM_FEED,[v.LATIN_SMALL_LETTER_N]:v.NEWLINE,[v.LATIN_SMALL_LETTER_R]:v.CARRIAGE_RETURN,[v.LATIN_SMALL_LETTER_T]:v.TAB};class Xr{constructor(){this.decoder=new TextDecoder("utf-8"),this.strings=[],this.byteLength=0}appendChar(e){this.strings.push(String.fromCharCode(e)),this.byteLength+=1}appendBuf(e,n=0,r=e.length){this.strings.push(this.decoder.decode(e.subarray(n,r))),this.byteLength+=r-n}reset(){this.strings=[],this.byteLength=0}toString(){return this.strings.join("")}}class ti{constructor(e){this.decoder=new TextDecoder("utf-8"),this.bufferOffset=0,this.string="",this.byteLength=0,this.buffer=new Uint8Array(e)}appendChar(e){this.bufferOffset>=this.buffer.length&&this.flushStringBuffer(),this.buffer[this.bufferOffset++]=e,this.byteLength+=1}appendBuf(e,n=0,r=e.length){const i=r-n;this.bufferOffset+i>this.buffer.length&&this.flushStringBuffer(),this.buffer.set(e.subarray(n,r),this.bufferOffset),this.bufferOffset+=i,this.byteLength+=i}flushStringBuffer(){this.string+=this.decoder.decode(this.buffer.subarray(0,this.bufferOffset)),this.bufferOffset=0}reset(){this.string="",this.bufferOffset=0,this.byteLength=0}toString(){return this.flushStringBuffer(),this.string}}var Hn;(function(t){t[t.LEFT_BRACE=0]="LEFT_BRACE",t[t.RIGHT_BRACE=1]="RIGHT_BRACE",t[t.LEFT_BRACKET=2]="LEFT_BRACKET",t[t.RIGHT_BRACKET=3]="RIGHT_BRACKET",t[t.COLON=4]="COLON",t[t.COMMA=5]="COMMA",t[t.TRUE=6]="TRUE",t[t.FALSE=7]="FALSE",t[t.NULL=8]="NULL",t[t.STRING=9]="STRING",t[t.NUMBER=10]="NUMBER",t[t.SEPARATOR=11]="SEPARATOR"})(Hn||(Hn={}));var x=Hn,A;(function(t){t[t.START=0]="START",t[t.ENDED=1]="ENDED",t[t.ERROR=2]="ERROR",t[t.TRUE1=3]="TRUE1",t[t.TRUE2=4]="TRUE2",t[t.TRUE3=5]="TRUE3",t[t.FALSE1=6]="FALSE1",t[t.FALSE2=7]="FALSE2",t[t.FALSE3=8]="FALSE3",t[t.FALSE4=9]="FALSE4",t[t.NULL1=10]="NULL1",t[t.NULL2=11]="NULL2",t[t.NULL3=12]="NULL3",t[t.STRING_DEFAULT=13]="STRING_DEFAULT",t[t.STRING_AFTER_BACKSLASH=14]="STRING_AFTER_BACKSLASH",t[t.STRING_UNICODE_DIGIT_1=15]="STRING_UNICODE_DIGIT_1",t[t.STRING_UNICODE_DIGIT_2=16]="STRING_UNICODE_DIGIT_2",t[t.STRING_UNICODE_DIGIT_3=17]="STRING_UNICODE_DIGIT_3",t[t.STRING_UNICODE_DIGIT_4=18]="STRING_UNICODE_DIGIT_4",t[t.STRING_INCOMPLETE_CHAR=19]="STRING_INCOMPLETE_CHAR",t[t.NUMBER_AFTER_INITIAL_MINUS=20]="NUMBER_AFTER_INITIAL_MINUS",t[t.NUMBER_AFTER_INITIAL_ZERO=21]="NUMBER_AFTER_INITIAL_ZERO",t[t.NUMBER_AFTER_INITIAL_NON_ZERO=22]="NUMBER_AFTER_INITIAL_NON_ZERO",t[t.NUMBER_AFTER_FULL_STOP=23]="NUMBER_AFTER_FULL_STOP",t[t.NUMBER_AFTER_DECIMAL=24]="NUMBER_AFTER_DECIMAL",t[t.NUMBER_AFTER_E=25]="NUMBER_AFTER_E",t[t.NUMBER_AFTER_E_AND_SIGN=26]="NUMBER_AFTER_E_AND_SIGN",t[t.NUMBER_AFTER_E_AND_DIGIT=27]="NUMBER_AFTER_E_AND_DIGIT",t[t.SEPARATOR=28]="SEPARATOR",t[t.BOM_OR_START=29]="BOM_OR_START",t[t.BOM=30]="BOM"})(A||(A={}));function ei(t){return["START","ENDED","ERROR","TRUE1","TRUE2","TRUE3","FALSE1","FALSE2","FALSE3","FALSE4","NULL1","NULL2","NULL3","STRING_DEFAULT","STRING_AFTER_BACKSLASH","STRING_UNICODE_DIGIT_1","STRING_UNICODE_DIGIT_2","STRING_UNICODE_DIGIT_3","STRING_UNICODE_DIGIT_4","STRING_INCOMPLETE_CHAR","NUMBER_AFTER_INITIAL_MINUS","NUMBER_AFTER_INITIAL_ZERO","NUMBER_AFTER_INITIAL_NON_ZERO","NUMBER_AFTER_FULL_STOP","NUMBER_AFTER_DECIMAL","NUMBER_AFTER_E","NUMBER_AFTER_E_AND_SIGN","NUMBER_AFTER_E_AND_DIGIT","SEPARATOR","BOM_OR_START","BOM"][t]}const As={stringBufferSize:0,numberBufferSize:0,separator:void 0,emitPartialTokens:!1};class fe extends Error{constructor(e){super(e),Object.setPrototypeOf(this,fe.prototype)}}class ni{constructor(e){this.state=A.BOM_OR_START,this.bomIndex=0,this.separatorIndex=0,this.bytes_remaining=0,this.bytes_in_sequence=0,this.char_split_buffer=new Uint8Array(4),this.encoder=new TextEncoder,this.offset=-1,e=Object.assign(Object.assign({},As),e),this.emitPartialTokens=e.emitPartialTokens===!0,this.bufferedString=e.stringBufferSize&&e.stringBufferSize>4?new ti(e.stringBufferSize):new Xr,this.bufferedNumber=e.numberBufferSize&&e.numberBufferSize>0?new ti(e.numberBufferSize):new Xr,this.separator=e.separator,this.separatorBytes=e.separator?this.encoder.encode(e.separator):void 0}get isEnded(){return this.state===A.ENDED}write(e){try{let n;if(e instanceof Uint8Array)n=e;else if(typeof e=="string")n=this.encoder.encode(e);else if(Array.isArray(e))n=Uint8Array.from(e);else if(ArrayBuffer.isView(e))n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);else throw new TypeError("Unexpected type. The `write` function only accepts Arrays, TypedArrays and Strings.");for(let r=0;r<n.length;r+=1){const i=n[r];switch(this.state){case A.BOM_OR_START:if(e instanceof Uint8Array&&i===239){this.bom=[239,187,191],this.bomIndex+=1,this.state=A.BOM;continue}if(e instanceof Uint16Array){if(i===254){this.bom=[254,255],this.bomIndex+=1,this.state=A.BOM;continue}if(i===255){this.bom=[255,254],this.bomIndex+=1,this.state=A.BOM;continue}}if(e instanceof Uint32Array){if(i===0){this.bom=[0,0,254,255],this.bomIndex+=1,this.state=A.BOM;continue}if(i===255){this.bom=[255,254,0,0],this.bomIndex+=1,this.state=A.BOM;continue}}case A.START:if(this.offset+=1,this.separatorBytes&&i===this.separatorBytes[0]){if(this.separatorBytes.length===1){this.state=A.START,this.onToken({token:x.SEPARATOR,value:this.separator,offset:this.offset+this.separatorBytes.length-1});continue}this.state=A.SEPARATOR;continue}if(i===v.SPACE||i===v.NEWLINE||i===v.CARRIAGE_RETURN||i===v.TAB)continue;if(i===v.LEFT_CURLY_BRACKET){this.onToken({token:x.LEFT_BRACE,value:"{",offset:this.offset});continue}if(i===v.RIGHT_CURLY_BRACKET){this.onToken({token:x.RIGHT_BRACE,value:"}",offset:this.offset});continue}if(i===v.LEFT_SQUARE_BRACKET){this.onToken({token:x.LEFT_BRACKET,value:"[",offset:this.offset});continue}if(i===v.RIGHT_SQUARE_BRACKET){this.onToken({token:x.RIGHT_BRACKET,value:"]",offset:this.offset});continue}if(i===v.COLON){this.onToken({token:x.COLON,value:":",offset:this.offset});continue}if(i===v.COMMA){this.onToken({token:x.COMMA,value:",",offset:this.offset});continue}if(i===v.LATIN_SMALL_LETTER_T){this.state=A.TRUE1;continue}if(i===v.LATIN_SMALL_LETTER_F){this.state=A.FALSE1;continue}if(i===v.LATIN_SMALL_LETTER_N){this.state=A.NULL1;continue}if(i===v.QUOTATION_MARK){this.bufferedString.reset(),this.state=A.STRING_DEFAULT;continue}if(i>=v.DIGIT_ONE&&i<=v.DIGIT_NINE){this.bufferedNumber.reset(),this.bufferedNumber.appendChar(i),this.state=A.NUMBER_AFTER_INITIAL_NON_ZERO;continue}if(i===v.DIGIT_ZERO){this.bufferedNumber.reset(),this.bufferedNumber.appendChar(i),this.state=A.NUMBER_AFTER_INITIAL_ZERO;continue}if(i===v.HYPHEN_MINUS){this.bufferedNumber.reset(),this.bufferedNumber.appendChar(i),this.state=A.NUMBER_AFTER_INITIAL_MINUS;continue}break;case A.STRING_DEFAULT:if(i===v.QUOTATION_MARK){const o=this.bufferedString.toString();this.state=A.START,this.onToken({token:x.STRING,value:o,offset:this.offset}),this.offset+=this.bufferedString.byteLength+1;continue}if(i===v.REVERSE_SOLIDUS){this.state=A.STRING_AFTER_BACKSLASH;continue}if(i>=128){if(i>=194&&i<=223?this.bytes_in_sequence=2:i<=239?this.bytes_in_sequence=3:this.bytes_in_sequence=4,this.bytes_in_sequence<=n.length-r){this.bufferedString.appendBuf(n,r,r+this.bytes_in_sequence),r+=this.bytes_in_sequence-1;continue}this.bytes_remaining=r+this.bytes_in_sequence-n.length,this.char_split_buffer.set(n.subarray(r)),r=n.length-1,this.state=A.STRING_INCOMPLETE_CHAR;continue}if(i>=v.SPACE){this.bufferedString.appendChar(i);continue}break;case A.STRING_INCOMPLETE_CHAR:this.char_split_buffer.set(n.subarray(r,r+this.bytes_remaining),this.bytes_in_sequence-this.bytes_remaining),this.bufferedString.appendBuf(this.char_split_buffer,0,this.bytes_in_sequence),r=this.bytes_remaining-1,this.state=A.STRING_DEFAULT;continue;case A.STRING_AFTER_BACKSLASH:const s=Ts[i];if(s){this.bufferedString.appendChar(s),this.state=A.STRING_DEFAULT;continue}if(i===v.LATIN_SMALL_LETTER_U){this.unicode="",this.state=A.STRING_UNICODE_DIGIT_1;continue}break;case A.STRING_UNICODE_DIGIT_1:case A.STRING_UNICODE_DIGIT_2:case A.STRING_UNICODE_DIGIT_3:if(i>=v.DIGIT_ZERO&&i<=v.DIGIT_NINE||i>=v.LATIN_CAPITAL_LETTER_A&&i<=v.LATIN_CAPITAL_LETTER_F||i>=v.LATIN_SMALL_LETTER_A&&i<=v.LATIN_SMALL_LETTER_F){this.unicode+=String.fromCharCode(i),this.state+=1;continue}break;case A.STRING_UNICODE_DIGIT_4:if(i>=v.DIGIT_ZERO&&i<=v.DIGIT_NINE||i>=v.LATIN_CAPITAL_LETTER_A&&i<=v.LATIN_CAPITAL_LETTER_F||i>=v.LATIN_SMALL_LETTER_A&&i<=v.LATIN_SMALL_LETTER_F){const o=parseInt(this.unicode+String.fromCharCode(i),16);this.highSurrogate===void 0?o>=55296&&o<=56319?this.highSurrogate=o:this.bufferedString.appendBuf(this.encoder.encode(String.fromCharCode(o))):(o>=56320&&o<=57343?this.bufferedString.appendBuf(this.encoder.encode(String.fromCharCode(this.highSurrogate,o))):this.bufferedString.appendBuf(this.encoder.encode(String.fromCharCode(this.highSurrogate))),this.highSurrogate=void 0),this.state=A.STRING_DEFAULT;continue}break;case A.NUMBER_AFTER_INITIAL_MINUS:if(i===v.DIGIT_ZERO){this.bufferedNumber.appendChar(i),this.state=A.NUMBER_AFTER_INITIAL_ZERO;continue}if(i>=v.DIGIT_ONE&&i<=v.DIGIT_NINE){this.bufferedNumber.appendChar(i),this.state=A.NUMBER_AFTER_INITIAL_NON_ZERO;continue}break;case A.NUMBER_AFTER_INITIAL_ZERO:if(i===v.FULL_STOP){this.bufferedNumber.appendChar(i),this.state=A.NUMBER_AFTER_FULL_STOP;continue}if(i===v.LATIN_SMALL_LETTER_E||i===v.LATIN_CAPITAL_LETTER_E){this.bufferedNumber.appendChar(i),this.state=A.NUMBER_AFTER_E;continue}r-=1,this.state=A.START,this.emitNumber();continue;case A.NUMBER_AFTER_INITIAL_NON_ZERO:if(i>=v.DIGIT_ZERO&&i<=v.DIGIT_NINE){this.bufferedNumber.appendChar(i);continue}if(i===v.FULL_STOP){this.bufferedNumber.appendChar(i),this.state=A.NUMBER_AFTER_FULL_STOP;continue}if(i===v.LATIN_SMALL_LETTER_E||i===v.LATIN_CAPITAL_LETTER_E){this.bufferedNumber.appendChar(i),this.state=A.NUMBER_AFTER_E;continue}r-=1,this.state=A.START,this.emitNumber();continue;case A.NUMBER_AFTER_FULL_STOP:if(i>=v.DIGIT_ZERO&&i<=v.DIGIT_NINE){this.bufferedNumber.appendChar(i),this.state=A.NUMBER_AFTER_DECIMAL;continue}break;case A.NUMBER_AFTER_DECIMAL:if(i>=v.DIGIT_ZERO&&i<=v.DIGIT_NINE){this.bufferedNumber.appendChar(i);continue}if(i===v.LATIN_SMALL_LETTER_E||i===v.LATIN_CAPITAL_LETTER_E){this.bufferedNumber.appendChar(i),this.state=A.NUMBER_AFTER_E;continue}r-=1,this.state=A.START,this.emitNumber();continue;case A.NUMBER_AFTER_E:if(i===v.PLUS_SIGN||i===v.HYPHEN_MINUS){this.bufferedNumber.appendChar(i),this.state=A.NUMBER_AFTER_E_AND_SIGN;continue}case A.NUMBER_AFTER_E_AND_SIGN:if(i>=v.DIGIT_ZERO&&i<=v.DIGIT_NINE){this.bufferedNumber.appendChar(i),this.state=A.NUMBER_AFTER_E_AND_DIGIT;continue}break;case A.NUMBER_AFTER_E_AND_DIGIT:if(i>=v.DIGIT_ZERO&&i<=v.DIGIT_NINE){this.bufferedNumber.appendChar(i);continue}r-=1,this.state=A.START,this.emitNumber();continue;case A.TRUE1:if(i===v.LATIN_SMALL_LETTER_R){this.state=A.TRUE2;continue}break;case A.TRUE2:if(i===v.LATIN_SMALL_LETTER_U){this.state=A.TRUE3;continue}break;case A.TRUE3:if(i===v.LATIN_SMALL_LETTER_E){this.state=A.START,this.onToken({token:x.TRUE,value:!0,offset:this.offset}),this.offset+=3;continue}break;case A.FALSE1:if(i===v.LATIN_SMALL_LETTER_A){this.state=A.FALSE2;continue}break;case A.FALSE2:if(i===v.LATIN_SMALL_LETTER_L){this.state=A.FALSE3;continue}break;case A.FALSE3:if(i===v.LATIN_SMALL_LETTER_S){this.state=A.FALSE4;continue}break;case A.FALSE4:if(i===v.LATIN_SMALL_LETTER_E){this.state=A.START,this.onToken({token:x.FALSE,value:!1,offset:this.offset}),this.offset+=4;continue}break;case A.NULL1:if(i===v.LATIN_SMALL_LETTER_U){this.state=A.NULL2;continue}break;case A.NULL2:if(i===v.LATIN_SMALL_LETTER_L){this.state=A.NULL3;continue}break;case A.NULL3:if(i===v.LATIN_SMALL_LETTER_L){this.state=A.START,this.onToken({token:x.NULL,value:null,offset:this.offset}),this.offset+=3;continue}break;case A.SEPARATOR:if(this.separatorIndex+=1,!this.separatorBytes||i!==this.separatorBytes[this.separatorIndex])break;this.separatorIndex===this.separatorBytes.length-1&&(this.state=A.START,this.onToken({token:x.SEPARATOR,value:this.separator,offset:this.offset+this.separatorIndex}),this.separatorIndex=0);continue;case A.BOM:if(i===this.bom[this.bomIndex]){if(this.bomIndex===this.bom.length-1){this.state=A.START,this.bom=void 0,this.bomIndex=0;continue}this.bomIndex+=1;continue}break;case A.ENDED:if(i===v.SPACE||i===v.NEWLINE||i===v.CARRIAGE_RETURN||i===v.TAB)continue}throw new fe(`Unexpected "${String.fromCharCode(i)}" at position "${r}" in state ${ei(this.state)}`)}if(this.emitPartialTokens)switch(this.state){case A.TRUE1:case A.TRUE2:case A.TRUE3:this.onToken({token:x.TRUE,value:!0,offset:this.offset,partial:!0});break;case A.FALSE1:case A.FALSE2:case A.FALSE3:case A.FALSE4:this.onToken({token:x.FALSE,value:!1,offset:this.offset,partial:!0});break;case A.NULL1:case A.NULL2:case A.NULL3:this.onToken({token:x.NULL,value:null,offset:this.offset,partial:!0});break;case A.STRING_DEFAULT:{const r=this.bufferedString.toString();this.onToken({token:x.STRING,value:r,offset:this.offset,partial:!0});break}case A.NUMBER_AFTER_INITIAL_ZERO:case A.NUMBER_AFTER_INITIAL_NON_ZERO:case A.NUMBER_AFTER_DECIMAL:case A.NUMBER_AFTER_E_AND_DIGIT:try{this.onToken({token:x.NUMBER,value:this.parseNumber(this.bufferedNumber.toString()),offset:this.offset,partial:!0})}catch{}}}catch(n){this.error(n)}}emitNumber(){this.onToken({token:x.NUMBER,value:this.parseNumber(this.bufferedNumber.toString()),offset:this.offset}),this.offset+=this.bufferedNumber.byteLength-1}parseNumber(e){return Number(e)}error(e){this.state!==A.ENDED&&(this.state=A.ERROR),this.onError(e)}end(){switch(this.state){case A.NUMBER_AFTER_INITIAL_ZERO:case A.NUMBER_AFTER_INITIAL_NON_ZERO:case A.NUMBER_AFTER_DECIMAL:case A.NUMBER_AFTER_E_AND_DIGIT:this.state=A.ENDED,this.emitNumber(),this.onEnd();break;case A.BOM_OR_START:case A.START:case A.ERROR:case A.SEPARATOR:this.state=A.ENDED,this.onEnd();break;default:this.error(new fe(`Tokenizer ended in the middle of a token (state: ${ei(this.state)}). Either not all the data was received or the data was invalid.`))}}onToken(e){throw new fe(`Can't emit tokens before the "onToken" callback has been set up.`)}onError(e){throw e}onEnd(){}}var tt;(function(t){t[t.OBJECT=0]="OBJECT",t[t.ARRAY=1]="ARRAY"})(tt||(tt={}));var k;(function(t){t[t.VALUE=0]="VALUE",t[t.KEY=1]="KEY",t[t.COLON=2]="COLON",t[t.COMMA=3]="COMMA",t[t.ENDED=4]="ENDED",t[t.ERROR=5]="ERROR",t[t.SEPARATOR=6]="SEPARATOR"})(k||(k={}));function ri(t){return["VALUE","KEY","COLON","COMMA","ENDED","ERROR","SEPARATOR"][t]}const Is={paths:void 0,keepStack:!0,separator:void 0,emitPartialValues:!1};class qt extends Error{constructor(e){super(e),Object.setPrototypeOf(this,qt.prototype)}}class ii{constructor(e){this.state=k.VALUE,this.mode=void 0,this.key=void 0,this.value=void 0,this.stack=[],e=Object.assign(Object.assign({},Is),e),e.paths&&(this.paths=e.paths.map(n=>{if(n===void 0||n==="$*")return;if(!n.startsWith("$"))throw new qt(`Invalid selector "${n}". Should start with "$".`);const r=n.split(".").slice(1);if(r.includes(""))throw new qt(`Invalid selector "${n}". ".." syntax not supported.`);return r})),this.keepStack=e.keepStack||!1,this.separator=e.separator,e.emitPartialValues||(this.emitPartial=()=>{})}shouldEmit(){return this.paths?this.paths.some(e=>{var n;if(e===void 0)return!0;if(e.length!==this.stack.length)return!1;for(let i=0;i<e.length-1;i++){const s=e[i],o=this.stack[i+1].key;if(s!=="*"&&s!==o)return!1}const r=e[e.length-1];return r==="*"?!0:r===((n=this.key)===null||n===void 0?void 0:n.toString())}):!0}push(){this.stack.push({key:this.key,value:this.value,mode:this.mode,emit:this.shouldEmit()})}pop(){const e=this.value;let n;({key:this.key,value:this.value,mode:this.mode,emit:n}=this.stack.pop()),this.state=this.mode!==void 0?k.COMMA:k.VALUE,this.emit(e,n)}emit(e,n){!this.keepStack&&this.value&&this.stack.every(r=>!r.emit)&&delete this.value[this.key],n&&this.onValue({value:e,key:this.key,parent:this.value,stack:this.stack}),this.stack.length===0&&(this.separator?this.state=k.SEPARATOR:this.separator===void 0&&this.end())}emitPartial(e){if(this.shouldEmit()){if(this.state===k.KEY){this.onValue({value:void 0,key:e,parent:this.value,stack:this.stack,partial:!0});return}this.onValue({value:e,key:this.key,parent:this.value,stack:this.stack,partial:!0})}}get isEnded(){return this.state===k.ENDED}write({token:e,value:n,partial:r}){try{if(r){this.emitPartial(n);return}if(this.state===k.VALUE){if(e===x.STRING||e===x.NUMBER||e===x.TRUE||e===x.FALSE||e===x.NULL){this.mode===tt.OBJECT?(this.value[this.key]=n,this.state=k.COMMA):this.mode===tt.ARRAY&&(this.value.push(n),this.state=k.COMMA),this.emit(n,this.shouldEmit());return}if(e===x.LEFT_BRACE){if(this.push(),this.mode===tt.OBJECT)this.value=this.value[this.key]={};else if(this.mode===tt.ARRAY){const i={};this.value.push(i),this.value=i}else this.value={};this.mode=tt.OBJECT,this.state=k.KEY,this.key=void 0,this.emitPartial();return}if(e===x.LEFT_BRACKET){if(this.push(),this.mode===tt.OBJECT)this.value=this.value[this.key]=[];else if(this.mode===tt.ARRAY){const i=[];this.value.push(i),this.value=i}else this.value=[];this.mode=tt.ARRAY,this.state=k.VALUE,this.key=0,this.emitPartial();return}if(this.mode===tt.ARRAY&&e===x.RIGHT_BRACKET&&this.value.length===0){this.pop();return}}if(this.state===k.KEY){if(e===x.STRING){this.key=n,this.state=k.COLON,this.emitPartial();return}if(e===x.RIGHT_BRACE&&Object.keys(this.value).length===0){this.pop();return}}if(this.state===k.COLON&&e===x.COLON){this.state=k.VALUE;return}if(this.state===k.COMMA){if(e===x.COMMA){if(this.mode===tt.ARRAY){this.state=k.VALUE,this.key+=1;return}if(this.mode===tt.OBJECT){this.state=k.KEY;return}}if(e===x.RIGHT_BRACE&&this.mode===tt.OBJECT||e===x.RIGHT_BRACKET&&this.mode===tt.ARRAY){this.pop();return}}if(this.state===k.SEPARATOR&&e===x.SEPARATOR&&n===this.separator){this.state=k.VALUE;return}throw new qt(`Unexpected ${x[e]} (${JSON.stringify(n)}) in state ${ri(this.state)}`)}catch(i){this.error(i)}}error(e){this.state!==k.ENDED&&(this.state=k.ERROR),this.onError(e)}end(){this.state!==k.VALUE&&this.state!==k.SEPARATOR||this.stack.length>0?this.error(new Error(`Parser ended in mid-parsing (state: ${ri(this.state)}). Either not all the data was received or the data was invalid.`)):(this.state=k.ENDED,this.onEnd())}onValue(e){throw new qt(`Can't emit data before the "onValue" callback has been set up.`)}onError(e){throw e}onEnd(){}}class bs{constructor(e={}){this.tokenizer=new ni(e),this.tokenParser=new ii(e),this.tokenizer.onToken=this.tokenParser.write.bind(this.tokenParser),this.tokenizer.onEnd=()=>{this.tokenParser.isEnded||this.tokenParser.end()},this.tokenParser.onError=this.tokenizer.error.bind(this.tokenizer),this.tokenParser.onEnd=()=>{this.tokenizer.isEnded||this.tokenizer.end()}}get isEnded(){return this.tokenizer.isEnded&&this.tokenParser.isEnded}write(e){this.tokenizer.write(e)}end(){this.tokenizer.end()}set onToken(e){this.tokenizer.onToken=n=>{e(n),this.tokenParser.write(n)}}set onValue(e){this.tokenParser.onValue=e}set onError(e){this.tokenizer.onError=e}set onEnd(e){this.tokenParser.onEnd=()=>{this.tokenizer.isEnded||this.tokenizer.end(),e.call(this.tokenParser)}}}function si(t){const{value:e,key:n,parent:r,stack:i,partial:s}=t;return{value:e,key:n,parent:oi(r),stack:oi(i),partial:s}}function oi(t){return typeof t!="object"||Array.isArray(t)&&t.filter(e=>e).length===0?t:JSON.parse(JSON.stringify(t))}class Ls extends bs{constructor(e){super(e),this.onValue=n=>this.controller.enqueue(si(n)),this.onError=n=>this.controller.error(n),this.onEnd=()=>this.controller.terminate()}start(e){this.controller=e}transform(e){this.write(e)}flush(){this.end()}}class ai extends TransformStream{constructor(e,n,r){const i=new Ls(e);super(i,n,r)}}class vs extends ni{constructor(e){super(e),this.onToken=n=>this.controller.enqueue(n),this.onError=n=>this.controller.error(n),this.onEnd=()=>this.controller.terminate()}start(e){this.controller=e}transform(e){this.write(e)}flush(){this.end()}}class po extends TransformStream{constructor(e,n,r){const i=new vs(e);super(i,n,r)}}class Rs extends ii{constructor(e){super(e),this.onValue=n=>this.controller.enqueue(si(n)),this.onError=n=>this.controller.error(n),this.onEnd=()=>this.controller.terminate()}start(e){this.controller=e}transform(e){this.write(e)}flush(){this.end()}}class yo extends TransformStream{constructor(e,n,r){const i=new Rs(e);super(i,n,r)}}function Ns(t,e){const n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function ws(t,e,n){let r=e[0],i=e[1],s=n[0]-r,o=n[1]-i;if(s!==0||o!==0){const a=((t[0]-r)*s+(t[1]-i)*o)/(s*s+o*o);a>1?(r=n[0],i=n[1]):a>0&&(r+=s*a,i+=o*a)}return s=t[0]-r,o=t[1]-i,s*s+o*o}function Ss(t,e){let n=t[0];const r=[n];let i=null;for(let s=1,o=t.length;s<o;s++)i=t[s],Ns(i,n)>e&&(r.push(i),n=i);return n!==i&&r.push(i),r}function qn(t,e,n,r,i){let s=r,o=0;for(let a=e+1;a<n;a++){const u=ws(t[a],t[e],t[n]);u>s&&(o=a,s=u)}s>r&&(o-e>1&&qn(t,e,o,r,i),i.push(t[o]),n-o>1&&qn(t,o,n,r,i))}function Ps(t,e){const n=t.length-1,r=[t[0]];return qn(t,0,n,e,r),r.push(t[n]),r}function xs(t,e,n){if(t.length<=2)return t;const r=e!==void 0?e*e:1;return t=n?t:Ss(t,r),t=Ps(t,r),t}function vt(t,e=1e4){return Math.round((t[0]+180)*e)*(1e3*e)+Math.round((t[1]+90)*e)}function Cs(t,e){const n=[],r=t.map(o=>{const a=vt(o);return e.has(a)});let i=0,s=r[0];for(let o=1;o<=r.length;o++)(o===r.length||r[o]!==s)&&(n.push({isCached:s,startIndex:i,endIndex:o-1}),i=o,s=o<r.length?r[o]:!s);return n}function Os(t,e,n,r){let i=0,s=0;for(;i<e.length&&s<n.length;){const o=n[s],a=vt(o),u=e[i],c=vt(u);r.set(c,a),c===a?(i++,s++):i++}return r}const ui=new Map;function li(t,e,n,r,i){return e.map((s,o)=>s.map((a,u)=>{const c=[];return Cs(a,i).forEach((f,h)=>{if(f.isCached)for(let d=f.startIndex;d<=f.endIndex;d++){const _=a[d],y=vt(_);i.get(y)===y&&c.push(_)}else{const d=a.slice(f.startIndex,f.endIndex+1),_=xs(d,n,r);d.length>0&&_.length>0&&(vt(d[0])!==vt(_[0])&&_.unshift(d[0]),vt(d[d.length-1])!==vt(_[_.length-1])&&_.push(d[d.length-1])),c.push(..._),Os(t,d,_,i)}}),c}).filter(a=>a.length>2)).filter(s=>s.length>0)}function ci(t){let e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;for(const s of t)for(let o=0;o<s.length;o+=2){const a=s[o];for(const u of a){const c=u[0],l=u[1];c<e&&(e=c),c>n&&(n=c),l<r&&(r=l),l>i&&(i=l)}}return{topLeft:{lng:e,lat:i},bottomRight:{lng:n,lat:r}}}function de(t){"@babel/helpers - typeof";return de=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},de(t)}function Ms(t,e){if(de(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(de(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function ks(t){var e=Ms(t,"string");return de(e)=="symbol"?e:String(e)}function pt(t,e,n){return e=ks(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const qe={x:0,y:1,z:2};function hi(t,e={}){const{start:n=0,end:r=t.length,plane:i="xy"}=e,s=e.size||2;let o=0;const a=qe[i[0]],u=qe[i[1]];for(let c=n,l=r-s;c<r;c+=s)o+=(t[c+a]-t[l+a])*(t[c+u]+t[l+u]),l=c;return o/2}function Ds(t,e,n=2,r,i="xy"){const s=e&&e.length,o=s?e[0]*n:t.length;let a=fi(t,0,o,n,!0,r&&r[0],i);const u=[];if(!a||a.next===a.prev)return u;let c,l,f,h,d,_,y;if(s&&(a=Ks(t,e,a,n,r,i)),t.length>80*n){h=l=t[0],d=f=t[1];for(let m=n;m<o;m+=n)_=t[m],y=t[m+1],_<h&&(h=_),y<d&&(d=y),_>l&&(l=_),y>f&&(f=y);c=Math.max(l-h,f-d),c=c!==0?32767/c:0}return _e(a,u,n,h,d,c,0),u}function fi(t,e,n,r,i,s,o){let a,u;s===void 0&&(s=hi(t,{start:e,end:n,size:r,plane:o}));let c=qe[o[0]],l=qe[o[1]];if(i===s<0)for(a=e;a<n;a+=r)u=pi(a,t[a+c],t[a+l],u);else for(a=n-r;a>=e;a-=r)u=pi(a,t[a+c],t[a+l],u);return u&&Ze(u,u.next)&&(ye(u),u=u.next),u}function Mt(t,e){if(!t)return t;e||(e=t);let n=t,r;do if(r=!1,!n.steiner&&(Ze(n,n.next)||j(n.prev,n,n.next)===0)){if(ye(n),n=e=n.prev,n===n.next)break;r=!0}else n=n.next;while(r||n!==e);return e}function _e(t,e,n,r,i,s,o){if(!t)return;!o&&s&&qs(t,r,i,s);let a=t,u,c;for(;t.prev!==t.next;){if(u=t.prev,c=t.next,s?Bs(t,r,i,s):Us(t)){e.push(u.i/n|0),e.push(t.i/n|0),e.push(c.i/n|0),ye(t),t=c.next,a=c.next;continue}if(t=c,t===a){o?o===1?(t=Fs(Mt(t),e,n),_e(t,e,n,r,i,s,2)):o===2&&Gs(t,e,n,r,i,s):_e(Mt(t),e,n,r,i,s,1);break}}}function Us(t){const e=t.prev,n=t,r=t.next;if(j(e,n,r)>=0)return!1;const i=e.x,s=n.x,o=r.x,a=e.y,u=n.y,c=r.y,l=i<s?i<o?i:o:s<o?s:o,f=a<u?a<c?a:c:u<c?u:c,h=i>s?i>o?i:o:s>o?s:o,d=a>u?a>c?a:c:u>c?u:c;let _=r.next;for(;_!==e;){if(_.x>=l&&_.x<=h&&_.y>=f&&_.y<=d&&Zt(i,a,s,u,o,c,_.x,_.y)&&j(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function Bs(t,e,n,r){const i=t.prev,s=t,o=t.next;if(j(i,s,o)>=0)return!1;const a=i.x,u=s.x,c=o.x,l=i.y,f=s.y,h=o.y,d=a<u?a<c?a:c:u<c?u:c,_=l<f?l<h?l:h:f<h?f:h,y=a>u?a>c?a:c:u>c?u:c,m=l>f?l>h?l:h:f>h?f:h,g=Zn(d,_,e,n,r),p=Zn(y,m,e,n,r);let E=t.prevZ,T=t.nextZ;for(;E&&E.z>=g&&T&&T.z<=p;){if(E.x>=d&&E.x<=y&&E.y>=_&&E.y<=m&&E!==i&&E!==o&&Zt(a,l,u,f,c,h,E.x,E.y)&&j(E.prev,E,E.next)>=0||(E=E.prevZ,T.x>=d&&T.x<=y&&T.y>=_&&T.y<=m&&T!==i&&T!==o&&Zt(a,l,u,f,c,h,T.x,T.y)&&j(T.prev,T,T.next)>=0))return!1;T=T.nextZ}for(;E&&E.z>=g;){if(E.x>=d&&E.x<=y&&E.y>=_&&E.y<=m&&E!==i&&E!==o&&Zt(a,l,u,f,c,h,E.x,E.y)&&j(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;T&&T.z<=p;){if(T.x>=d&&T.x<=y&&T.y>=_&&T.y<=m&&T!==i&&T!==o&&Zt(a,l,u,f,c,h,T.x,T.y)&&j(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function Fs(t,e,n){let r=t;do{const i=r.prev,s=r.next.next;!Ze(i,s)&&di(i,r,r.next,s)&&pe(i,s)&&pe(s,i)&&(e.push(i.i/n|0),e.push(r.i/n|0),e.push(s.i/n|0),ye(r),ye(r.next),r=t=s),r=r.next}while(r!==t);return Mt(r)}function Gs(t,e,n,r,i,s){let o=t;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&Ws(o,a)){let u=_i(o,a);o=Mt(o,o.next),u=Mt(u,u.next),_e(o,e,n,r,i,s,0),_e(u,e,n,r,i,s,0);return}a=a.next}o=o.next}while(o!==t)}function Ks(t,e,n,r,i,s){const o=[];let a,u,c,l,f;for(a=0,u=e.length;a<u;a++)c=e[a]*r,l=a<u-1?e[a+1]*r:t.length,f=fi(t,c,l,r,!1,i&&i[a+1],s),f===f.next&&(f.steiner=!0),o.push(Ys(f));for(o.sort(js),a=0;a<o.length;a++)n=$s(o[a],n);return n}function js(t,e){return t.x-e.x}function $s(t,e){const n=Vs(t,e);if(!n)return e;const r=_i(n,t);return Mt(r,r.next),Mt(n,n.next)}function Vs(t,e){let n=e;const r=t.x,i=t.y;let s=-1/0,o;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const h=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(h<=r&&h>s&&(s=h,o=n.x<n.next.x?n:n.next,h===r))return o}n=n.next}while(n!==e);if(!o)return null;const a=o,u=o.x,c=o.y;let l=1/0,f;n=o;do r>=n.x&&n.x>=u&&r!==n.x&&Zt(i<c?r:s,i,u,c,i<c?s:r,i,n.x,n.y)&&(f=Math.abs(i-n.y)/(r-n.x),pe(n,t)&&(f<l||f===l&&(n.x>o.x||n.x===o.x&&Hs(o,n)))&&(o=n,l=f)),n=n.next;while(n!==a);return o}function Hs(t,e){return j(t.prev,t,e.prev)<0&&j(e.next,t,t.next)<0}function qs(t,e,n,r){let i=t;do i.z===0&&(i.z=Zn(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,Zs(i)}function Zs(t){let e,n,r=1,i,s,o,a,u,c;do{for(s=t,t=null,c=null,i=0;s;){for(i++,a=s,o=0,n=0;n<r&&(o++,a=a.nextZ,!!a);n++);for(u=r;o>0||u>0&&a;)o!==0&&(u===0||!a||s.z<=a.z)?(e=s,s=s.nextZ,o--):(e=a,a=a.nextZ,u--),c?c.nextZ=e:t=e,e.prevZ=c,c=e;s=a}c.nextZ=null,r*=2}while(i>1);return t}function Zn(t,e,n,r,i){return t=(t-n)*i|0,e=(e-r)*i|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function Ys(t){let e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Zt(t,e,n,r,i,s,o,a){return(i-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(r-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(i-o)*(r-a)}function Ws(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!zs(t,e)&&(pe(t,e)&&pe(e,t)&&Js(t,e)&&(j(t.prev,t,e.prev)||j(t,e.prev,e))||Ze(t,e)&&j(t.prev,t,t.next)>0&&j(e.prev,e,e.next)>0)}function j(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Ze(t,e){return t.x===e.x&&t.y===e.y}function di(t,e,n,r){const i=We(j(t,e,n)),s=We(j(t,e,r)),o=We(j(n,r,t)),a=We(j(n,r,e));return!!(i!==s&&o!==a||i===0&&Ye(t,n,e)||s===0&&Ye(t,r,e)||o===0&&Ye(n,t,r)||a===0&&Ye(n,e,r))}function Ye(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function We(t){return t>0?1:t<0?-1:0}function zs(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&di(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function pe(t,e){return j(t.prev,t,t.next)<0?j(t,e,t.next)>=0&&j(t,t.prev,e)>=0:j(t,e,t.prev)<0||j(t,t.next,e)<0}function Js(t,e){let n=t,r=!1;const i=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==t);return r}function _i(t,e){const n=new Yn(t.i,t.x,t.y),r=new Yn(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function pi(t,e,n,r){const i=new Yn(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function ye(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}class Yn{constructor(e,n,r){pt(this,"i",void 0),pt(this,"x",void 0),pt(this,"y",void 0),pt(this,"prev",null),pt(this,"next",null),pt(this,"z",0),pt(this,"prevZ",null),pt(this,"nextZ",null),pt(this,"steiner",!1),this.i=e,this.x=n,this.y=r}}function Qs(t,e,n){const r=Xs(t),i=Object.keys(r).filter(s=>r[s]!==Array);return to(t,{propArrayTypes:r,...e},{numericPropKeys:n&&n.numericPropKeys||i,PositionDataType:n?n.PositionDataType:Float32Array,triangulate:n?n.triangulate:!0})}function Xs(t){const e={};for(const n of t)if(n.properties)for(const r in n.properties){const i=n.properties[r];e[r]=oo(i,e[r])}return e}function to(t,e,n){const{pointPositionsCount:r,pointFeaturesCount:i,linePositionsCount:s,linePathsCount:o,lineFeaturesCount:a,polygonPositionsCount:u,polygonObjectsCount:c,polygonRingsCount:l,polygonFeaturesCount:f,propArrayTypes:h,coordLength:d}=e,{numericPropKeys:_=[],PositionDataType:y=Float32Array,triangulate:m=!0}=n,g=t[0]&&"id"in t[0],p=t.length>65535?Uint32Array:Uint16Array,E={type:"Point",positions:new y(r*d),globalFeatureIds:new p(r),featureIds:i>65535?new Uint32Array(r):new Uint16Array(r),numericProps:{},properties:[],fields:[]},T={type:"LineString",pathIndices:s>65535?new Uint32Array(o+1):new Uint16Array(o+1),positions:new y(s*d),globalFeatureIds:new p(s),featureIds:a>65535?new Uint32Array(s):new Uint16Array(s),numericProps:{},properties:[],fields:[]},L={type:"Polygon",polygonIndices:u>65535?new Uint32Array(c+1):new Uint16Array(c+1),primitivePolygonIndices:u>65535?new Uint32Array(l+1):new Uint16Array(l+1),positions:new y(u*d),globalFeatureIds:new p(u),featureIds:f>65535?new Uint32Array(u):new Uint16Array(u),numericProps:{},properties:[],fields:[]};m&&(L.triangles=[]);for(const b of[E,T,L])for(const S of _){const I=h[S];b.numericProps[S]=new I(b.positions.length/d)}T.pathIndices[o]=s,L.polygonIndices[c]=u,L.primitivePolygonIndices[l]=u;const R={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(const b of t){const S=b.geometry,I=b.properties||{};switch(S.type){case"Point":eo(S,E,R,d,I),E.properties.push(Jn(I,_)),g&&E.fields.push({id:b.id}),R.pointFeature++;break;case"LineString":no(S,T,R,d,I),T.properties.push(Jn(I,_)),g&&T.fields.push({id:b.id}),R.lineFeature++;break;case"Polygon":ro(S,L,R,d,I),L.properties.push(Jn(I,_)),g&&L.fields.push({id:b.id}),R.polygonFeature++;break;default:throw new Error("Invalid geometry type")}R.feature++}return so(E,T,L,d)}function eo(t,e,n,r,i){e.positions.set(t.data,n.pointPosition*r);const s=t.data.length/r;zn(e,i,n.pointPosition,s),e.globalFeatureIds.fill(n.feature,n.pointPosition,n.pointPosition+s),e.featureIds.fill(n.pointFeature,n.pointPosition,n.pointPosition+s),n.pointPosition+=s}function no(t,e,n,r,i){e.positions.set(t.data,n.linePosition*r);const s=t.data.length/r;zn(e,i,n.linePosition,s),e.globalFeatureIds.fill(n.feature,n.linePosition,n.linePosition+s),e.featureIds.fill(n.lineFeature,n.linePosition,n.linePosition+s);for(let o=0,a=t.indices.length;o<a;++o){const u=t.indices[o],c=o===a-1?t.data.length:t.indices[o+1];e.pathIndices[n.linePath++]=n.linePosition,n.linePosition+=(c-u)/r}}function ro(t,e,n,r,i){e.positions.set(t.data,n.polygonPosition*r);const s=t.data.length/r;zn(e,i,n.polygonPosition,s),e.globalFeatureIds.fill(n.feature,n.polygonPosition,n.polygonPosition+s),e.featureIds.fill(n.polygonFeature,n.polygonPosition,n.polygonPosition+s);for(let o=0,a=t.indices.length;o<a;++o){const u=n.polygonPosition;e.polygonIndices[n.polygonObject++]=u;const c=t.areas[o],l=t.indices[o],f=t.indices[o+1];for(let d=0,_=l.length;d<_;++d){const y=l[d],m=d===_-1?f===void 0?t.data.length:f[0]:l[d+1];e.primitivePolygonIndices[n.polygonRing++]=n.polygonPosition,n.polygonPosition+=(m-y)/r}const h=n.polygonPosition;io(e,c,l,{startPosition:u,endPosition:h,coordLength:r})}}function io(t,e,n,r){let{startPosition:i,endPosition:s,coordLength:o}=r;if(!t.triangles)return;const a=i*o,u=s*o,c=t.positions.subarray(a,u),l=n[0],f=n.slice(1).map(d=>(d-l)/o),h=Ds(c,f,o,e);for(let d=0,_=h.length;d<_;++d)t.triangles.push(i+h[d])}function Wn(t,e){const n={};for(const r in t)n[r]={value:t[r],size:e};return n}function so(t,e,n,r){const i={shape:"binary-feature-collection",points:{...t,positions:{value:t.positions,size:r},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:Wn(t.numericProps,1)},lines:{...e,positions:{value:e.positions,size:r},pathIndices:{value:e.pathIndices,size:1},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:Wn(e.numericProps,1)},polygons:{...n,positions:{value:n.positions,size:r},polygonIndices:{value:n.polygonIndices,size:1},primitivePolygonIndices:{value:n.primitivePolygonIndices,size:1},globalFeatureIds:{value:n.globalFeatureIds,size:1},featureIds:{value:n.featureIds,size:1},numericProps:Wn(n.numericProps,1)}};return i.polygons&&n.triangles&&(i.polygons.triangles={value:new Uint32Array(n.triangles),size:1}),i}function zn(t,e,n,r){for(const i in t.numericProps)if(i in e){const s=e[i];t.numericProps[i].fill(s,n,n+r)}}function Jn(t,e){const n={};for(const r in t)e.includes(r)||(n[r]=t[r]);return n}function oo(t,e){return e===Array||!Number.isFinite(t)?Array:e===Float64Array||Math.fround(t)!==t?Float64Array:Float32Array}function ao(t){let e=0,n=0,r=0,i=0,s=0,o=0,a=0,u=0,c=0;const l=new Set;for(const f of t){const h=f.geometry;switch(h.type){case"Point":n++,e++,l.add(h.coordinates.length);break;case"MultiPoint":n++,e+=h.coordinates.length;for(const _ of h.coordinates)l.add(_.length);break;case"LineString":s++,r+=h.coordinates.length,i++;for(const _ of h.coordinates)l.add(_.length);break;case"MultiLineString":s++;for(const _ of h.coordinates){r+=_.length,i++;for(const y of _)l.add(y.length)}break;case"Polygon":c++,a++,u+=h.coordinates.length;const d=h.coordinates.flat();o+=d.length;for(const _ of d)l.add(_.length);break;case"MultiPolygon":c++;for(const _ of h.coordinates){a++,u+=_.length;const y=_.flat();o+=y.length;for(const m of y)l.add(m.length)}break;default:throw new Error(`Unsupported geometry type: ${h.type}`)}}return{coordLength:l.size>0?Math.max(...l):2,pointPositionsCount:e,pointFeaturesCount:n,linePositionsCount:r,linePathsCount:i,lineFeaturesCount:s,polygonPositionsCount:o,polygonObjectsCount:a,polygonRingsCount:u,polygonFeaturesCount:c}}function uo(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{coordLength:2,fixRingWinding:!0};return t.map(n=>lo(n,e))}function yi(t,e,n,r){n.push(e.length),e.push(...t);for(let i=t.length;i<r.coordLength;i++)e.push(0)}function Qn(t,e,n,r){n.push(e.length);for(const i of t){e.push(...i);for(let s=i.length;s<r.coordLength;s++)e.push(0)}}function gi(t,e,n,r,i){let s=0;const o=[],a=[];for(const u of t){const c=u.map(h=>h.slice(0,2));let l=hi(c.flat());const f=l<0;i.fixRingWinding&&(s===0&&!f||s>0&&f)&&(u.reverse(),l=-l),o.push(l),Qn(u,e,a,i),s++}s>0&&(r.push(o),n.push(a))}function lo(t,e){const{geometry:n}=t;if(n.type==="GeometryCollection")throw new Error("GeometryCollection type not supported");const r=[],i=[];let s,o;switch(n.type){case"Point":o="Point",yi(n.coordinates,r,i,e);break;case"MultiPoint":o="Point",n.coordinates.map(a=>yi(a,r,i,e));break;case"LineString":o="LineString",Qn(n.coordinates,r,i,e);break;case"MultiLineString":o="LineString",n.coordinates.map(a=>Qn(a,r,i,e));break;case"Polygon":o="Polygon",s=[],gi(n.coordinates,r,i,s,e);break;case"MultiPolygon":o="Polygon",s=[],n.coordinates.map(a=>gi(a,r,i,s,e));break;default:throw new Error(`Unknown type: ${o}`)}return{...t,geometry:{type:o,indices:i,data:r,areas:s}}}function co(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{fixRingWinding:!0,triangulate:!0};const n=ao(t),r=n.coordLength,{fixRingWinding:i}=e,s=uo(t,{coordLength:r,fixRingWinding:i});return Qs(s,n,{numericPropKeys:e.numericPropKeys,PositionDataType:e.PositionDataType||Float32Array,triangulate:e.triangulate})}var ge=(t=>(t.started="started",t.progress="progress",t.cancel="cancel",t.error="error",t.finished="finished",t))(ge||{});class Xn extends bt{constructor(e){super(e),this.version(10).stores({countries:"++id, name, &gid_0, "+Lt+","+Ot,regions1:"++id, name, resourceIdRef, &[gid_0+gid_1], "+Lt+","+Ot,regions2:"++id, resourceIdRef, name, &[gid_0+gid_1+gid_2], "+Lt+","+Ot,points:"++id, resourceIdRef, type, country, name_1, name, &[country+name_1+name], "+Lt,routeSegments:"++id, resourceIdRef, mode, sourceCountry, sourceName1, sourceName2, sourceName, targetCountry, targetName1, targetName2, targetName, sourceIdRef, targetIdRef, &[sourceIdRef+targetIdRef], "+Lt+","+Ot,gadm0:"++id, name, &gid_0, "+Lt+","+Ot,gadm1:"++id, name, resourceIdRef, &[gid_0+gid_1], "+Lt+","+Ot,gadm2:"++id, resourceIdRef, name, &[gid_0+gid_1+gid_2], "+Lt+","+Ot}),this.countries=this.table("countries"),this.regions1=this.table("regions1"),this.regions2=this.table("regions2"),this.points=this.table("points"),this.routeSegments=this.table("routeSegments"),this.gadm0=this.table("gadm0"),this.gadm1=this.table("gadm1"),this.gadm2=this.table("gadm2")}static fileNameOf(e,n){switch(e){case Vt.resources:return`${Vr}-${n}`;case Vt.projects:return`${Hr}-${n}`;default:throw new Error("invalid type:"+e)}}static async openResource(e){return new Xn(this.fileNameOf(Vt.resources,e))}async findAllGeoRegions(e,n){const r=0<=n&&n<=2?[this.countries]:n<=4?[this.countries,this.regions1]:[this.regions1,this.regions2];return(await Promise.all(r.map(async i=>{const s=[];for(let o=n;o>=0;o--)if(e[n].length===1){if(s.push(i.where(`z${n}`).anyOf(e[n][0]).toArray()),e[n][0].length===1)break}else s.push(i.where(`z${n}`).anyOf(e[n].length===2?e[n][0].concat(e[n][1]):e[n][0]).toArray());return(await Promise.all(s)).flat(1)}))).flat(1)}async findAllGeoPoints(e,n){const r=this.points,i=[];for(let s=n;s>=0;s--)if(e[n].length===1){if(i.push(r.where(`z${n}`).anyOf(e[n][0]).toArray()),e[n][0].length===1)break}else i.push(r.where(`z${n}`).anyOf(e[n].length===2?e[n][0].concat(e[n][1]):e[n][0]).toArray());return(await Promise.all(i)).flat(1)}async findAllGeoLineStrings(e,n){const r=this.routeSegments,i=[];for(let s=n;s>=0;s--)if(e[n].length===1){if(i.push(r.where(`z${n}`).anyOf(e[n][0]).toArray()),e[n][0].length===1)break}else i.push(r.where(`z${n}`).anyOf(e[n].length===2?e[n][0].concat(e[n][1]):e[n][0]).toArray());return(await Promise.all(i)).flat(1)}async storeGISRouteSegment(e){const n=await Promise.all(e.map(async r=>{const{sourceCountry:i,sourceName1:s,sourceName2:o,sourceName:a,targetCountry:u,targetName1:c,targetName2:l,targetName:f}=r,h=await this.findGISPoint({country:i,name_1:s,name_2:o,name:a}),d=await this.findGISPoint({country:u,name_1:c,name_2:l,name:f});if(h===void 0||d===void 0||h.id===void 0||d.id===void 0)throw new Error;const[_,y]=h.lat>d.lat?[h.lat,d.lat]:[d.lat,h.lat],[m,g]=h.lng>d.lng?[h.lng,d.lng]:[d.lng,h.lng],p=ps({lat:_,lng:m},{lat:y,lng:g},Ht),E={...r,uuid:ms(),sourceIdRef:h.uuid,targetIdRef:d.uuid,...p};return console.log(E),E}));await this.routeSegments.bulkAdd(n)}async findGISPoint({country:e,name_1:n,name_2:r,name:i}){return this.points.where("[country+name_1+name_2+name]").equals(e+n+r+i).last()}async storeAsGeoJson({stream:e,fileName:n,fileSize:r,startedCallback:i,progressCallback:s,errorCallback:o,finishedCallback:a,cancelCallback:u}){let l=[],f=[],h=[];const d=new ai({stringBufferSize:void 0,paths:["$.features"],keepStack:!1}),_=async(g,p,E)=>{g.bulkAdd(p).catch(T=>{o&&o(E,T.message)})};let y=0;const m=async g=>{i&&i(n,this.name),g.getReader().read().then(p=>{const{done:E,value:T}=p;if(E)return;const L=T.value;y+=L.length,L.forEach((R,b)=>{const{COUNTRY:S,NAME_1:I,NAME_2:C,GID_0:O,GID_1:$,GID_2:H}=R.properties,U=R.geometry.coordinates,st=li(`${S}	${I}	${C}`,U,zr,!0,ui),G={},q=ci(st);for(let D=0;D<=Ht;D++){const rt=$n(q.topLeft,q.bottomRight,D);if(rt.length===0)G[`z${D}`]=Jr.NOT_CONTAINED;else if(rt.length===1)if(rt[0].length===1)G[`z${D}`]=rt[0][0];else if(rt[0].length>=2)G[`z${D}`]=G[`z${D-1}`];else throw new Error;else if(rt.length===2)rt[1].length===1?G[`z${D}_`]=rt[1][0]:rt[1].length>=2&&(G[`z${D}_`]=G[`z${D-1}_`]);else throw new Error("mortonNumber.length > 2 :"+rt.join(" ,"))}const Y=co(L,{PositionDataType:Float32Array,fixRingWinding:!0}),K={country:S,gid_0:O,binaryFeatures:Y,...G};L.some(D=>{var rt;return((rt=D.coordinates)==null?void 0:rt.length)>0})&&K.country&&(I?C?h.push({...K,name_1:I,gid_1:$,name_2:C,gid_2:H,name:K.name_2}):f.push({...K,name_1:I,gid_1:$,name:K.name_1}):l.push({...K,name:K.country}),s&&s({type:ge.progress,progress:b/L.length*100,index:b,total:y,unit:"items",fileName:n,fileSize:r||-1}),l.length===64&&(_(this.gadm0,l,n),l=[]),f.length===64&&(_(this.gadm1,f,n),f=[]),h.length===64&&(_(this.gadm2,h,n),h=[]))}),l.length>0&&_(this.gadm0,l,n),f.length>0&&_(this.gadm1,f,n),h.length>0&&_(this.gadm2,h,n),s&&s({type:ge.progress,fileName:n,fileSize:r,progress:100,total:y,index:y,unit:"items_end"}),a&&a(n)})};try{await m(e.pipeThrough(d))}catch(g){console.error(g),o&&o(n,g.message);return}}async storeGadmGeoJson({stream:e,fileName:n,fileSize:r,startedCallback:i,progressCallback:s,errorCallback:o,finishedCallback:a,cancelCallback:u}){await this.storeAsGeoRegion({stream:e,fileName:n,fileSize:r,startedCallback:i,progressCallback:s,errorCallback:o,finishedCallback:a,cancelCallback:u})}async storeAsGeoRegion({stream:e,fileName:n,fileSize:r,startedCallback:i,progressCallback:s,errorCallback:o,finishedCallback:a,cancelCallback:u}){let l=[],f=[],h=[];const d=new ai({stringBufferSize:void 0,paths:["$.features"],keepStack:!1}),_=async(g,p,E)=>{g.bulkAdd(p).catch(T=>{o&&o(E,T.message)})};let y=0;const m=async g=>{i&&i(n,this.name),g.getReader().read().then(p=>{const{done:E,value:T}=p;if(E)return;const L=T.value;y+=L.length,L.forEach((R,b)=>{const{COUNTRY:S,NAME_1:I,NAME_2:C,GID_0:O,GID_1:$,GID_2:H}=R.properties,U=R.geometry.coordinates,st=li(`${S}	${I}	${C}`,U,zr,!0,ui),G={},q=ci(st);for(let K=0;K<=Ht;K++){const D=$n(q.topLeft,q.bottomRight,K);if(D.length===0)G[`z${K}`]=Jr.NOT_CONTAINED;else if(D.length===1)if(D[0].length===1)G[`z${K}`]=D[0][0];else if(D[0].length>=2)G[`z${K}`]=G[`z${K-1}`];else throw new Error;else if(D.length===2)D[1].length===1?G[`z${K}_`]=D[1][0]:D[1].length>=2&&(G[`z${K}_`]=G[`z${K-1}_`]);else throw new Error("mortonNumber.length > 2 :"+D.join(" ,"))}const Y={country:S,gid_0:O,coordinates:st,...G};Y.coordinates.length>0&&Y.country&&(I?C?h.push({...Y,name_1:I,gid_1:$,name_2:C,gid_2:H,name:Y.name_2}):f.push({...Y,name_1:I,gid_1:$,name:Y.name_1}):l.push({...Y,name:Y.country}),s&&s({type:ge.progress,progress:b/L.length*100,index:b,total:y,unit:"items",fileName:n,fileSize:r||-1}),l.length===64&&(_(this.countries,l,n),l=[]),f.length===64&&(_(this.regions1,f,n),f=[]),h.length===64&&(_(this.regions2,h,n),h=[]))}),l.length>0&&_(this.countries,l,n),f.length>0&&_(this.regions1,f,n),h.length>0&&_(this.regions2,h,n),s&&s({type:ge.progress,fileName:n,fileSize:r,progress:100,total:y,index:y,unit:"items_end"}),a&&a(n)})};try{await m(e.pipeThrough(d))}catch(g){console.error(g),o&&o(n,g.message);return}}}async function ho(t,e,n){const r=[],i=[],s=[],o=await(await Kn.openProject(t)).getLayerPanelState();if(!o)throw new Error("NoGadmGeoJsonResourceEntity");await Promise.all(o.gadmGeoJsonUuid.map(async I=>{const C=await Xn.openResource(I);r.push(await C.findAllGeoPoints(e,n)),i.push(await C.findAllGeoLineStrings(e,n)),s.push(await C.findAllGeoRegions(e,n))}));const a=r.flat(1).map(I=>({id:I.name,centerPosition:[I.lng,I.lat],radius:10,strokeWidth:1,strokeColor:[255,0,0,255],fillColor:[255,0,0,15]})),u=ds(a),l=i.flat(1).map(I=>({sourcePositionIDRef:I.sourceIdRef,targetPositionIDRef:I.targetIdRef,strokeWidth:1,strokeColor:[0,0,255,255]})),f=ls(a),{buffer:h,indices:d}=cs(l,u),_=[20,40,60,20],y=[20,60,40,20],m=[60,20,40,20],g=[60,40,20,20],p=s.flat(1).map(I=>({strokeWidth:1,strokeColor:[30,40,50,60],fillColor:I.gid_2?_:I.gid_1?y:I.gid_0?m:g,coordinates:I.coordinates})),{positions:E,polygonIndices:T,pathIndices:L,lineWidths:R,lineColors:b,fillColors:S}=fs(p);return[f,h,d,E,T,L,R,b,S]}async function fo(t,e){const n=await ho(e.uuid,e.mortonNumbers,e.zoom);postMessage(n)}onmessage=function(e){if(e.data.type!=="dexie")return;const n=JSON.parse(e.data.payload);fo(e.data.id,n)}})();
